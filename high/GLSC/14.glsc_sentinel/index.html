<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>商城高级-Sentinel服务流控熔断降级 | lwy&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e1aa9d15d62220ec692a843c08c79000";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>        
    </script>
    <script src="https://fastly.jsdelivr.net/npm/twikoo@1.5.11/dist/twikoo.all.min.js"></script>
    <script href="./js/index.js" async="async"></script>
    <link rel="icon" href="https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/20220627/mmexport1656324824543.124zxwkqyzlc.webp">
    <script charset="utf-8" href="./js/main.js"></script>
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="一起学习编程!">
    <meta name="image" content="https://frxcat.fun/./assets/14.glsc_sentinel/590075a1ce0b0efdf18f9107db129e55.png">
    <meta name="twitter:title" content="商城高级-Sentinel服务流控熔断降级">
    <meta name="twitter:description" content="">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://frxcat.fun/./assets/14.glsc_sentinel/590075a1ce0b0efdf18f9107db129e55.png">
    <meta name="twitter:url" content="https://frxcat.fun/baodian/high/GLSC/14.glsc_sentinel.html">
    <meta name="twitter:site" content="@frxcat">
    <meta property="og:type" content="article">
    <meta property="og:title" content="商城高级-Sentinel服务流控熔断降级">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://frxcat.fun/./assets/14.glsc_sentinel/590075a1ce0b0efdf18f9107db129e55.png">
    <meta property="og:url" content="https://frxcat.fun/baodian/high/GLSC/14.glsc_sentinel.html">
    <meta property="og:site_name" content="frxcat">
    <meta property="article:published_time" content="2022-11-07T21:59:30.000Z">
    <meta property="article:tag" content="谷粒商城">
    <meta itemprop="name" content="商城高级-Sentinel服务流控熔断降级">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://frxcat.fun/./assets/14.glsc_sentinel/590075a1ce0b0efdf18f9107db129e55.png">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="baidu-site-verification" content="code-5aMKYEt9fV">
    <link rel="preload" href="/assets/css/0.styles.47be26a6.css" as="style"><link rel="preload" href="/assets/js/app.52078691.js" as="script"><link rel="preload" href="/assets/js/2.3705e0fd.js" as="script"><link rel="preload" href="/assets/js/5.65db3320.js" as="script"><link rel="preload" href="/assets/js/41.f9580004.js" as="script"><link rel="preload" href="/assets/js/62.88bcb186.js" as="script"><link rel="preload" href="/assets/js/68.17898152.js" as="script"><link rel="preload" href="/assets/js/53.6e4f0023.js" as="script"><link rel="preload" href="/assets/js/54.7ab2b710.js" as="script"><link rel="prefetch" href="/assets/js/10.9737349b.js"><link rel="prefetch" href="/assets/js/100.ce9d8915.js"><link rel="prefetch" href="/assets/js/101.f87843de.js"><link rel="prefetch" href="/assets/js/102.70976c26.js"><link rel="prefetch" href="/assets/js/103.af0ae479.js"><link rel="prefetch" href="/assets/js/104.08019755.js"><link rel="prefetch" href="/assets/js/105.5ba4095d.js"><link rel="prefetch" href="/assets/js/106.972a8f34.js"><link rel="prefetch" href="/assets/js/107.12e9ddb4.js"><link rel="prefetch" href="/assets/js/108.28e874b2.js"><link rel="prefetch" href="/assets/js/109.9b8d4781.js"><link rel="prefetch" href="/assets/js/11.b6770bd0.js"><link rel="prefetch" href="/assets/js/110.22af2046.js"><link rel="prefetch" href="/assets/js/111.e6983aec.js"><link rel="prefetch" href="/assets/js/112.1f240eff.js"><link rel="prefetch" href="/assets/js/113.d14bc345.js"><link rel="prefetch" href="/assets/js/114.4aa404d9.js"><link rel="prefetch" href="/assets/js/115.99538e07.js"><link rel="prefetch" href="/assets/js/116.208b8283.js"><link rel="prefetch" href="/assets/js/117.b1d409af.js"><link rel="prefetch" href="/assets/js/118.d47b4c00.js"><link rel="prefetch" href="/assets/js/119.370cd414.js"><link rel="prefetch" href="/assets/js/12.bd5c2d8b.js"><link rel="prefetch" href="/assets/js/120.1fa4e63b.js"><link rel="prefetch" href="/assets/js/121.a4fe7a0f.js"><link rel="prefetch" href="/assets/js/122.2bfb2933.js"><link rel="prefetch" href="/assets/js/123.aa149f19.js"><link rel="prefetch" href="/assets/js/124.e8464955.js"><link rel="prefetch" href="/assets/js/125.575955d0.js"><link rel="prefetch" href="/assets/js/126.4dff1740.js"><link rel="prefetch" href="/assets/js/127.09db1a96.js"><link rel="prefetch" href="/assets/js/128.943fa020.js"><link rel="prefetch" href="/assets/js/129.5aed95c9.js"><link rel="prefetch" href="/assets/js/13.9cbc2efd.js"><link rel="prefetch" href="/assets/js/130.245e9fdc.js"><link rel="prefetch" href="/assets/js/131.581380a1.js"><link rel="prefetch" href="/assets/js/132.60db6223.js"><link rel="prefetch" href="/assets/js/133.96797ef5.js"><link rel="prefetch" href="/assets/js/134.b688c12a.js"><link rel="prefetch" href="/assets/js/135.4e3da7b9.js"><link rel="prefetch" href="/assets/js/136.6ca77d45.js"><link rel="prefetch" href="/assets/js/137.bcb83ecf.js"><link rel="prefetch" href="/assets/js/138.4a67aa90.js"><link rel="prefetch" href="/assets/js/139.a9de0505.js"><link rel="prefetch" href="/assets/js/14.0503a1f8.js"><link rel="prefetch" href="/assets/js/140.000d224c.js"><link rel="prefetch" href="/assets/js/141.d4417d1a.js"><link rel="prefetch" href="/assets/js/142.9f63cf5c.js"><link rel="prefetch" href="/assets/js/143.52301d1e.js"><link rel="prefetch" href="/assets/js/144.183c8304.js"><link rel="prefetch" href="/assets/js/145.cafbbce0.js"><link rel="prefetch" href="/assets/js/146.b07ef39d.js"><link rel="prefetch" href="/assets/js/147.f8c98c90.js"><link rel="prefetch" href="/assets/js/148.a1db8613.js"><link rel="prefetch" href="/assets/js/149.3f6baedb.js"><link rel="prefetch" href="/assets/js/15.d34a8df4.js"><link rel="prefetch" href="/assets/js/150.d0ed51f5.js"><link rel="prefetch" href="/assets/js/151.b2b0401c.js"><link rel="prefetch" href="/assets/js/152.e650aea9.js"><link rel="prefetch" href="/assets/js/153.086cfb5b.js"><link rel="prefetch" href="/assets/js/154.996b563c.js"><link rel="prefetch" href="/assets/js/155.40fd70fa.js"><link rel="prefetch" href="/assets/js/156.69d0287c.js"><link rel="prefetch" href="/assets/js/157.5575a854.js"><link rel="prefetch" href="/assets/js/158.c8c3db15.js"><link rel="prefetch" href="/assets/js/159.62cfff25.js"><link rel="prefetch" href="/assets/js/16.6451f778.js"><link rel="prefetch" href="/assets/js/160.08eed556.js"><link rel="prefetch" href="/assets/js/161.309275e7.js"><link rel="prefetch" href="/assets/js/162.2eb8eaa9.js"><link rel="prefetch" href="/assets/js/163.44b7949e.js"><link rel="prefetch" href="/assets/js/164.6f6d645f.js"><link rel="prefetch" href="/assets/js/165.c5d88775.js"><link rel="prefetch" href="/assets/js/166.69dfbb33.js"><link rel="prefetch" href="/assets/js/167.4b1ee20c.js"><link rel="prefetch" href="/assets/js/168.1ed9dde6.js"><link rel="prefetch" href="/assets/js/169.e23242bb.js"><link rel="prefetch" href="/assets/js/17.7550e5c8.js"><link rel="prefetch" href="/assets/js/170.784b6d48.js"><link rel="prefetch" href="/assets/js/171.50a83b35.js"><link rel="prefetch" href="/assets/js/172.40c931dc.js"><link rel="prefetch" href="/assets/js/173.244612f1.js"><link rel="prefetch" href="/assets/js/174.4104b8a3.js"><link rel="prefetch" href="/assets/js/175.c2b2ee17.js"><link rel="prefetch" href="/assets/js/176.d8eaa441.js"><link rel="prefetch" href="/assets/js/177.e90c3831.js"><link rel="prefetch" href="/assets/js/178.30b27b94.js"><link rel="prefetch" href="/assets/js/179.854eb2e3.js"><link rel="prefetch" href="/assets/js/18.7a103199.js"><link rel="prefetch" href="/assets/js/180.350f5024.js"><link rel="prefetch" href="/assets/js/181.80b2d200.js"><link rel="prefetch" href="/assets/js/182.c2b971a6.js"><link rel="prefetch" href="/assets/js/183.74680f68.js"><link rel="prefetch" href="/assets/js/184.0325e3d7.js"><link rel="prefetch" href="/assets/js/185.ec78a717.js"><link rel="prefetch" href="/assets/js/186.dca301d6.js"><link rel="prefetch" href="/assets/js/187.42e89237.js"><link rel="prefetch" href="/assets/js/188.3d89a625.js"><link rel="prefetch" href="/assets/js/189.ec5bb043.js"><link rel="prefetch" href="/assets/js/19.df1fef81.js"><link rel="prefetch" href="/assets/js/190.fd14816e.js"><link rel="prefetch" href="/assets/js/191.8e55628c.js"><link rel="prefetch" href="/assets/js/192.ff48f421.js"><link rel="prefetch" href="/assets/js/193.03757d8b.js"><link rel="prefetch" href="/assets/js/194.6dbc284a.js"><link rel="prefetch" href="/assets/js/195.4ec15c3e.js"><link rel="prefetch" href="/assets/js/196.beda4d6e.js"><link rel="prefetch" href="/assets/js/197.5064a624.js"><link rel="prefetch" href="/assets/js/198.43286ea8.js"><link rel="prefetch" href="/assets/js/199.301b3707.js"><link rel="prefetch" href="/assets/js/20.e0e9251f.js"><link rel="prefetch" href="/assets/js/200.d54667f8.js"><link rel="prefetch" href="/assets/js/201.d3e38772.js"><link rel="prefetch" href="/assets/js/202.609eee44.js"><link rel="prefetch" href="/assets/js/203.891daf04.js"><link rel="prefetch" href="/assets/js/204.b1ec7758.js"><link rel="prefetch" href="/assets/js/205.419a76de.js"><link rel="prefetch" href="/assets/js/206.06dacd15.js"><link rel="prefetch" href="/assets/js/207.07d858a5.js"><link rel="prefetch" href="/assets/js/208.e9e9d1a3.js"><link rel="prefetch" href="/assets/js/209.eed886b0.js"><link rel="prefetch" href="/assets/js/21.b29bbfd0.js"><link rel="prefetch" href="/assets/js/210.1b3fc6c1.js"><link rel="prefetch" href="/assets/js/211.2828e206.js"><link rel="prefetch" href="/assets/js/212.b4145674.js"><link rel="prefetch" href="/assets/js/213.40581007.js"><link rel="prefetch" href="/assets/js/214.10021b7a.js"><link rel="prefetch" href="/assets/js/215.c63ea6cd.js"><link rel="prefetch" href="/assets/js/216.a4c7698a.js"><link rel="prefetch" href="/assets/js/217.1a0d8ee7.js"><link rel="prefetch" href="/assets/js/218.39707446.js"><link rel="prefetch" href="/assets/js/219.d88c14a5.js"><link rel="prefetch" href="/assets/js/22.40bd7391.js"><link rel="prefetch" href="/assets/js/220.f2426e81.js"><link rel="prefetch" href="/assets/js/221.ba868543.js"><link rel="prefetch" href="/assets/js/222.b176c69e.js"><link rel="prefetch" href="/assets/js/223.8d89753d.js"><link rel="prefetch" href="/assets/js/224.85f7d7c5.js"><link rel="prefetch" href="/assets/js/225.bc929c1a.js"><link rel="prefetch" href="/assets/js/226.c1a508ca.js"><link rel="prefetch" href="/assets/js/227.50eb23c4.js"><link rel="prefetch" href="/assets/js/228.c830f0ed.js"><link rel="prefetch" href="/assets/js/229.f85d6beb.js"><link rel="prefetch" href="/assets/js/23.4097c0c1.js"><link rel="prefetch" href="/assets/js/230.96c62d70.js"><link rel="prefetch" href="/assets/js/231.612e981b.js"><link rel="prefetch" href="/assets/js/232.6e0c1ae8.js"><link rel="prefetch" href="/assets/js/233.a1c9f425.js"><link rel="prefetch" href="/assets/js/234.d2e0ad23.js"><link rel="prefetch" href="/assets/js/235.279f0b35.js"><link rel="prefetch" href="/assets/js/236.7ab53cbc.js"><link rel="prefetch" href="/assets/js/237.43a4af2e.js"><link rel="prefetch" href="/assets/js/238.fe5c7fb7.js"><link rel="prefetch" href="/assets/js/239.75b41961.js"><link rel="prefetch" href="/assets/js/24.80d0ea88.js"><link rel="prefetch" href="/assets/js/240.51559559.js"><link rel="prefetch" href="/assets/js/241.694be33f.js"><link rel="prefetch" href="/assets/js/242.a703c270.js"><link rel="prefetch" href="/assets/js/243.da64b731.js"><link rel="prefetch" href="/assets/js/244.15eeffbb.js"><link rel="prefetch" href="/assets/js/245.5f3dc510.js"><link rel="prefetch" href="/assets/js/246.784553ea.js"><link rel="prefetch" href="/assets/js/247.f8ea5fdf.js"><link rel="prefetch" href="/assets/js/248.bada25c2.js"><link rel="prefetch" href="/assets/js/249.bc9dd416.js"><link rel="prefetch" href="/assets/js/25.e8691b15.js"><link rel="prefetch" href="/assets/js/250.1f4519ae.js"><link rel="prefetch" href="/assets/js/251.9f27016e.js"><link rel="prefetch" href="/assets/js/252.9789c0ce.js"><link rel="prefetch" href="/assets/js/253.61d9c2ff.js"><link rel="prefetch" href="/assets/js/254.462c1534.js"><link rel="prefetch" href="/assets/js/255.31d681e1.js"><link rel="prefetch" href="/assets/js/256.3f32f819.js"><link rel="prefetch" href="/assets/js/257.d63fd914.js"><link rel="prefetch" href="/assets/js/258.5bcfe9aa.js"><link rel="prefetch" href="/assets/js/259.b90ca4b1.js"><link rel="prefetch" href="/assets/js/26.4811050d.js"><link rel="prefetch" href="/assets/js/260.ec35a84d.js"><link rel="prefetch" href="/assets/js/261.adaf3e9c.js"><link rel="prefetch" href="/assets/js/262.ffb4323c.js"><link rel="prefetch" href="/assets/js/263.7eac7f34.js"><link rel="prefetch" href="/assets/js/264.20216400.js"><link rel="prefetch" href="/assets/js/265.63289daa.js"><link rel="prefetch" href="/assets/js/266.e575e597.js"><link rel="prefetch" href="/assets/js/267.b4d4982d.js"><link rel="prefetch" href="/assets/js/268.fb0ad32c.js"><link rel="prefetch" href="/assets/js/269.eff28f67.js"><link rel="prefetch" href="/assets/js/27.9457ca9e.js"><link rel="prefetch" href="/assets/js/270.0fe5a756.js"><link rel="prefetch" href="/assets/js/271.965a0032.js"><link rel="prefetch" href="/assets/js/272.dadc37da.js"><link rel="prefetch" href="/assets/js/273.74c233e5.js"><link rel="prefetch" href="/assets/js/274.faaf2837.js"><link rel="prefetch" href="/assets/js/275.ebf1a886.js"><link rel="prefetch" href="/assets/js/276.88095e66.js"><link rel="prefetch" href="/assets/js/277.8de99fb3.js"><link rel="prefetch" href="/assets/js/278.c5ccf883.js"><link rel="prefetch" href="/assets/js/279.d2a2a622.js"><link rel="prefetch" href="/assets/js/28.15e050ac.js"><link rel="prefetch" href="/assets/js/280.ccc75b75.js"><link rel="prefetch" href="/assets/js/281.6a99caed.js"><link rel="prefetch" href="/assets/js/282.1a5662a1.js"><link rel="prefetch" href="/assets/js/283.3f1abb3d.js"><link rel="prefetch" href="/assets/js/284.e8083077.js"><link rel="prefetch" href="/assets/js/285.d5502c5a.js"><link rel="prefetch" href="/assets/js/286.0bf35ff3.js"><link rel="prefetch" href="/assets/js/287.f8606aa4.js"><link rel="prefetch" href="/assets/js/288.43aafdd0.js"><link rel="prefetch" href="/assets/js/289.1f225e1f.js"><link rel="prefetch" href="/assets/js/29.fc604ea8.js"><link rel="prefetch" href="/assets/js/290.511c1ecb.js"><link rel="prefetch" href="/assets/js/291.2a97f2f8.js"><link rel="prefetch" href="/assets/js/292.60f07469.js"><link rel="prefetch" href="/assets/js/293.513e4f12.js"><link rel="prefetch" href="/assets/js/294.1e3142f1.js"><link rel="prefetch" href="/assets/js/295.f6dd6bb0.js"><link rel="prefetch" href="/assets/js/296.f27849d1.js"><link rel="prefetch" href="/assets/js/297.8299d6c2.js"><link rel="prefetch" href="/assets/js/298.736bb09f.js"><link rel="prefetch" href="/assets/js/299.1a1d84bb.js"><link rel="prefetch" href="/assets/js/3.34330720.js"><link rel="prefetch" href="/assets/js/30.0dc5bdaf.js"><link rel="prefetch" href="/assets/js/300.b1e44f73.js"><link rel="prefetch" href="/assets/js/301.f4b3766a.js"><link rel="prefetch" href="/assets/js/302.1b3978e5.js"><link rel="prefetch" href="/assets/js/303.1d2d380e.js"><link rel="prefetch" href="/assets/js/304.9b1eb3e1.js"><link rel="prefetch" href="/assets/js/305.c0a6482f.js"><link rel="prefetch" href="/assets/js/306.2da8847d.js"><link rel="prefetch" href="/assets/js/307.de86dbf4.js"><link rel="prefetch" href="/assets/js/308.64af9f4e.js"><link rel="prefetch" href="/assets/js/309.a43d581f.js"><link rel="prefetch" href="/assets/js/31.56b3711d.js"><link rel="prefetch" href="/assets/js/310.4d6c6ec0.js"><link rel="prefetch" href="/assets/js/311.10e0994d.js"><link rel="prefetch" href="/assets/js/312.444c5360.js"><link rel="prefetch" href="/assets/js/313.ae5b8015.js"><link rel="prefetch" href="/assets/js/314.48737017.js"><link rel="prefetch" href="/assets/js/315.a8d7c9f0.js"><link rel="prefetch" href="/assets/js/316.2ce73af7.js"><link rel="prefetch" href="/assets/js/317.8bbe6a4f.js"><link rel="prefetch" href="/assets/js/318.18ea088d.js"><link rel="prefetch" href="/assets/js/319.f99b3850.js"><link rel="prefetch" href="/assets/js/32.98e21745.js"><link rel="prefetch" href="/assets/js/320.bf33a93f.js"><link rel="prefetch" href="/assets/js/321.7795d606.js"><link rel="prefetch" href="/assets/js/322.15ee300f.js"><link rel="prefetch" href="/assets/js/323.8f69f55d.js"><link rel="prefetch" href="/assets/js/324.56376288.js"><link rel="prefetch" href="/assets/js/325.1ddb3a11.js"><link rel="prefetch" href="/assets/js/326.dd92c51e.js"><link rel="prefetch" href="/assets/js/327.636535c1.js"><link rel="prefetch" href="/assets/js/328.ecab5d99.js"><link rel="prefetch" href="/assets/js/329.f3471637.js"><link rel="prefetch" href="/assets/js/33.5cb151f0.js"><link rel="prefetch" href="/assets/js/330.6bcc345d.js"><link rel="prefetch" href="/assets/js/331.2c6587ef.js"><link rel="prefetch" href="/assets/js/332.55251f19.js"><link rel="prefetch" href="/assets/js/333.913c2b69.js"><link rel="prefetch" href="/assets/js/334.35003154.js"><link rel="prefetch" href="/assets/js/335.9801f78b.js"><link rel="prefetch" href="/assets/js/336.0e7bcd51.js"><link rel="prefetch" href="/assets/js/337.a1d950ac.js"><link rel="prefetch" href="/assets/js/338.8715b7e7.js"><link rel="prefetch" href="/assets/js/339.aa147c68.js"><link rel="prefetch" href="/assets/js/34.d8f76763.js"><link rel="prefetch" href="/assets/js/340.7f66359e.js"><link rel="prefetch" href="/assets/js/341.16692663.js"><link rel="prefetch" href="/assets/js/342.acae3279.js"><link rel="prefetch" href="/assets/js/343.fb6498a0.js"><link rel="prefetch" href="/assets/js/344.d987f6c4.js"><link rel="prefetch" href="/assets/js/345.2e2a1575.js"><link rel="prefetch" href="/assets/js/346.23cb7ed6.js"><link rel="prefetch" href="/assets/js/347.dc457dab.js"><link rel="prefetch" href="/assets/js/348.d278ae56.js"><link rel="prefetch" href="/assets/js/349.f472beb4.js"><link rel="prefetch" href="/assets/js/35.1927e840.js"><link rel="prefetch" href="/assets/js/350.693f46d7.js"><link rel="prefetch" href="/assets/js/351.8379e2bc.js"><link rel="prefetch" href="/assets/js/352.3c7bdcc6.js"><link rel="prefetch" href="/assets/js/353.327ce979.js"><link rel="prefetch" href="/assets/js/354.cd7508a0.js"><link rel="prefetch" href="/assets/js/355.6180aaad.js"><link rel="prefetch" href="/assets/js/356.66d21afe.js"><link rel="prefetch" href="/assets/js/357.acd36a95.js"><link rel="prefetch" href="/assets/js/358.543c7a5f.js"><link rel="prefetch" href="/assets/js/359.c255a149.js"><link rel="prefetch" href="/assets/js/36.0d770678.js"><link rel="prefetch" href="/assets/js/37.3bdb5cfe.js"><link rel="prefetch" href="/assets/js/38.3aedc88f.js"><link rel="prefetch" href="/assets/js/39.7033fe79.js"><link rel="prefetch" href="/assets/js/4.a76891f2.js"><link rel="prefetch" href="/assets/js/40.8ad3fb1f.js"><link rel="prefetch" href="/assets/js/42.e363d915.js"><link rel="prefetch" href="/assets/js/43.1132b9a3.js"><link rel="prefetch" href="/assets/js/44.fdaae5bc.js"><link rel="prefetch" href="/assets/js/45.d73821d7.js"><link rel="prefetch" href="/assets/js/46.bf9a345e.js"><link rel="prefetch" href="/assets/js/47.5c4abc58.js"><link rel="prefetch" href="/assets/js/48.34950cd2.js"><link rel="prefetch" href="/assets/js/49.1ec0762a.js"><link rel="prefetch" href="/assets/js/50.652c485a.js"><link rel="prefetch" href="/assets/js/51.877b9a08.js"><link rel="prefetch" href="/assets/js/52.ead5e03f.js"><link rel="prefetch" href="/assets/js/55.1a84271a.js"><link rel="prefetch" href="/assets/js/56.7ec80127.js"><link rel="prefetch" href="/assets/js/57.b81aaa00.js"><link rel="prefetch" href="/assets/js/58.6ac03d81.js"><link rel="prefetch" href="/assets/js/59.0d1a6f34.js"><link rel="prefetch" href="/assets/js/6.145042a1.js"><link rel="prefetch" href="/assets/js/60.f62b6344.js"><link rel="prefetch" href="/assets/js/61.9e4959cd.js"><link rel="prefetch" href="/assets/js/63.7df25f03.js"><link rel="prefetch" href="/assets/js/64.247e1298.js"><link rel="prefetch" href="/assets/js/65.c8329589.js"><link rel="prefetch" href="/assets/js/66.68670215.js"><link rel="prefetch" href="/assets/js/67.1765e15d.js"><link rel="prefetch" href="/assets/js/69.fd3bd675.js"><link rel="prefetch" href="/assets/js/7.64b824a1.js"><link rel="prefetch" href="/assets/js/70.be083088.js"><link rel="prefetch" href="/assets/js/71.34d2826d.js"><link rel="prefetch" href="/assets/js/72.19ab5be1.js"><link rel="prefetch" href="/assets/js/73.19afbfb9.js"><link rel="prefetch" href="/assets/js/74.f6adbfae.js"><link rel="prefetch" href="/assets/js/75.5d6ed878.js"><link rel="prefetch" href="/assets/js/76.a98f9057.js"><link rel="prefetch" href="/assets/js/77.2c7ee7a9.js"><link rel="prefetch" href="/assets/js/78.65ea061d.js"><link rel="prefetch" href="/assets/js/79.4893c957.js"><link rel="prefetch" href="/assets/js/8.7ff72049.js"><link rel="prefetch" href="/assets/js/80.72463664.js"><link rel="prefetch" href="/assets/js/81.99bc6553.js"><link rel="prefetch" href="/assets/js/82.653fa55a.js"><link rel="prefetch" href="/assets/js/83.0878479e.js"><link rel="prefetch" href="/assets/js/84.82a035c3.js"><link rel="prefetch" href="/assets/js/85.1b7de756.js"><link rel="prefetch" href="/assets/js/86.327e80da.js"><link rel="prefetch" href="/assets/js/87.51de929e.js"><link rel="prefetch" href="/assets/js/88.211a0254.js"><link rel="prefetch" href="/assets/js/89.ca5538d2.js"><link rel="prefetch" href="/assets/js/9.158c7fa3.js"><link rel="prefetch" href="/assets/js/90.d5e79edf.js"><link rel="prefetch" href="/assets/js/91.1be6359e.js"><link rel="prefetch" href="/assets/js/92.cbb1aa69.js"><link rel="prefetch" href="/assets/js/93.59feba4a.js"><link rel="prefetch" href="/assets/js/94.8cc33ac2.js"><link rel="prefetch" href="/assets/js/95.b0ae84fc.js"><link rel="prefetch" href="/assets/js/96.d019867f.js"><link rel="prefetch" href="/assets/js/97.3271008e.js"><link rel="prefetch" href="/assets/js/98.85cad3d9.js"><link rel="prefetch" href="/assets/js/99.45fc9fb4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.47be26a6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">lwy's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pages/f6054a/" class="nav-link">导航🚀​</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e05ef5/" class="nav-link">JavaSE</a></li></ul></li><li class="dropdown-item"><h4>JavaWeb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5cda88/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/cea341/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/pages/8f83ba/" class="nav-link">Servlet</a></li><li class="dropdown-subitem"><a href="/pages/8bc1c4/" class="nav-link">MVC</a></li><li class="dropdown-subitem"><a href="/pages/f883e2/" class="nav-link">filter|listener</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><!----> <span class="title" style="display:;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/462a90/" class="nav-link">Spring5</a></li><li class="dropdown-item"><!----> <a href="/pages/2e990c/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/pages/0d4af0/" class="nav-link">SpringBoot2</a></li><li class="dropdown-item"><!----> <a href="/pages/870083/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/66babb/" class="nav-link">SpringSecurity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/596552/" class="nav-link">ElasticSearch</a></li></ul></li><li class="dropdown-item"><h4>消息队列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e645d9/" class="nav-link">RabbitMQ</a></li></ul></li><li class="dropdown-item"><h4>服务器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9551ee/" class="nav-link">Nginx🌐</a></li></ul></li><li class="dropdown-item"><h4>服务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/48771f/" class="nav-link">Dubbo</a></li></ul></li><li class="dropdown-item"><h4>常用框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/46271f/" class="nav-link">SSO</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9268d/" class="nav-link">Python基础</a></li><li class="dropdown-subitem"><a href="/pages/e0bd06/" class="nav-link">数据分析</a></li></ul></li><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/600247/" class="nav-link">Hadoop集群</a></li><li class="dropdown-subitem"><a href="/pages/cdeb68/" class="nav-link">KVM虚拟化技术</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e72480/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7ab056/" class="nav-link">NoSQL数据库概论</a></li><li class="dropdown-subitem"><a href="/pages/e9cc9f/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/pages/91197c/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/pages/2aae92/" class="nav-link">HBase</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0e424f/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/pages/e0594a/" class="nav-link">MyBatis-Plus</a></li><li class="dropdown-subitem"><a href="/pages/1f54f3/" class="nav-link">ShardingSphere</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/99e9dc/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/90cc29/" class="nav-link">Docker基础</a></li><li class="dropdown-subitem"><a href="/pages/90ac28/" class="nav-link">Docker高级</a></li></ul></li><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/45eca1/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/pages/34892c/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><!----> <span class="title" style="display:;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/40ee62/" class="nav-link">力扣算法题</a></li><li class="dropdown-item"><!----> <a href="/pages/39659d/" class="nav-link">基础开发篇</a></li><li class="dropdown-item"><h4>进阶篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/60k8c2/" class="nav-link">中高进阶篇</a></li><li class="dropdown-subitem"><a href="/pages/29c8c2/" class="nav-link">谷粒商城</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/myfriends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/mdUse/" class="nav-link">md使用</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="本站" class="dropdown-title"><!----> <span class="title" style="display:;">本站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9013e4/" class="nav-link">关于</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/qie.png"> <div class="blogger-info"><h3>lwy</h3> <span>一起学习编程!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/pages/f6054a/" class="nav-link">导航🚀​</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e05ef5/" class="nav-link">JavaSE</a></li></ul></li><li class="dropdown-item"><h4>JavaWeb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5cda88/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/cea341/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/pages/8f83ba/" class="nav-link">Servlet</a></li><li class="dropdown-subitem"><a href="/pages/8bc1c4/" class="nav-link">MVC</a></li><li class="dropdown-subitem"><a href="/pages/f883e2/" class="nav-link">filter|listener</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><!----> <span class="title" style="display:;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/462a90/" class="nav-link">Spring5</a></li><li class="dropdown-item"><!----> <a href="/pages/2e990c/" class="nav-link">SpringMVC</a></li><li class="dropdown-item"><!----> <a href="/pages/0d4af0/" class="nav-link">SpringBoot2</a></li><li class="dropdown-item"><!----> <a href="/pages/870083/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/66babb/" class="nav-link">SpringSecurity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>搜索引擎</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/596552/" class="nav-link">ElasticSearch</a></li></ul></li><li class="dropdown-item"><h4>消息队列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e645d9/" class="nav-link">RabbitMQ</a></li></ul></li><li class="dropdown-item"><h4>服务器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9551ee/" class="nav-link">Nginx🌐</a></li></ul></li><li class="dropdown-item"><h4>服务框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/48771f/" class="nav-link">Dubbo</a></li></ul></li><li class="dropdown-item"><h4>常用框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/46271f/" class="nav-link">SSO</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b9268d/" class="nav-link">Python基础</a></li><li class="dropdown-subitem"><a href="/pages/e0bd06/" class="nav-link">数据分析</a></li></ul></li><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/600247/" class="nav-link">Hadoop集群</a></li><li class="dropdown-subitem"><a href="/pages/cdeb68/" class="nav-link">KVM虚拟化技术</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/e72480/" class="nav-link">MySQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7ab056/" class="nav-link">NoSQL数据库概论</a></li><li class="dropdown-subitem"><a href="/pages/e9cc9f/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/pages/91197c/" class="nav-link">MongoDB</a></li><li class="dropdown-subitem"><a href="/pages/2aae92/" class="nav-link">HBase</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0e424f/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/pages/e0594a/" class="nav-link">MyBatis-Plus</a></li><li class="dropdown-subitem"><a href="/pages/1f54f3/" class="nav-link">ShardingSphere</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/99e9dc/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/90cc29/" class="nav-link">Docker基础</a></li><li class="dropdown-subitem"><a href="/pages/90ac28/" class="nav-link">Docker高级</a></li></ul></li><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/45eca1/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/pages/34892c/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><!----> <span class="title" style="display:;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/40ee62/" class="nav-link">力扣算法题</a></li><li class="dropdown-item"><!----> <a href="/pages/39659d/" class="nav-link">基础开发篇</a></li><li class="dropdown-item"><h4>进阶篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/60k8c2/" class="nav-link">中高进阶篇</a></li><li class="dropdown-subitem"><a href="/pages/29c8c2/" class="nav-link">谷粒商城</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/myfriends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/mdUse/" class="nav-link">md使用</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="本站" class="dropdown-title"><!----> <span class="title" style="display:;">本站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9013e4/" class="nav-link">关于</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>力扣算法题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/40ee62/" class="sidebar-link">LeetCode 算法题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础开发篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/39659d/" class="sidebar-link">java基础</a></li><li><a href="/pages/39h591/" class="sidebar-link">linux</a></li><li><a href="/pages/39h592/" class="sidebar-link">mq</a></li><li><a href="/pages/39h593/" class="sidebar-link">nginx</a></li><li><a href="/pages/39h594/" class="sidebar-link">dubbo</a></li><li><a href="/pages/39hl95/" class="sidebar-link">mysql</a></li><li><a href="/pages/39hl96/" class="sidebar-link">springboot</a></li><li><a href="/pages/3phl97/" class="sidebar-link">mybatis</a></li><li><a href="/pages/3lhl98/" class="sidebar-link">spring</a></li><li><a href="/pages/3lhh91/" class="sidebar-link">多线程&amp;并发篇</a></li><li><a href="/pages/3lhq91/" class="sidebar-link">jvm</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>中高进阶篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/60k8c2/" class="sidebar-link">分布式篇</a></li><li><a href="/pages/60k8c3/" class="sidebar-link">网络篇</a></li><li><a href="/pages/60k8c4/" class="sidebar-link">设计模式</a></li><li><a href="/pages/60k8c5/" class="sidebar-link">maven篇</a></li><li><a href="/pages/60k8c6/" class="sidebar-link">ElasticSearch篇</a></li><li><a href="/pages/60k8c7/" class="sidebar-link">tomcat篇</a></li><li><a href="/pages/60k8c8/" class="sidebar-link">git篇</a></li><li><a href="/pages/60k8c9/" class="sidebar-link">redis篇</a></li><li><a href="/pages/60k810/" class="sidebar-link">zookeeper篇</a></li><li><a href="/pages/60k820/" class="sidebar-link">SpringCloud篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>谷粒商城</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/29c8c2/" class="sidebar-link">商城基础-项目概述</a></li><li><a href="/high/GLSC/2.glsc_environment_build/" class="sidebar-link">商城基础-环境搭建</a></li><li><a href="/high/GLSC/3.glsc_springcloud/" class="sidebar-link">商城基础-SpringCloud</a></li><li><a href="/high/GLSC/4.glsc_vue/" class="sidebar-link">商城基础-vue</a></li><li><a href="/high/GLSC/5.glsc_product_service/" class="sidebar-link">商城基础-商品服务</a></li><li><a href="/high/GLSC/6.glsc_warehouse_service/" class="sidebar-link">商城基础-仓储服务</a></li><li><a href="/high/GLSC/7.glsc_elasticsearch/" class="sidebar-link">商城高级-elasticsearch</a></li><li><a href="/high/GLSC/8.glsc_product_up/" class="sidebar-link">商城高级-商品上架</a></li><li><a href="/high/GLSC/9.glsc_pressure_test/" class="sidebar-link">商城高级-压力测试</a></li><li><a href="/high/GLSC/10.glsc_cache_redisson/" class="sidebar-link">商城高级-缓存与分布式锁</a></li><li><a href="/high/GLSC/11.glsc_search_service/" class="sidebar-link">商城高级-检索服务</a></li><li><a href="/high/GLSC/12.glsc_auth_service/" class="sidebar-link">商城高级-认证服务</a></li><li><a href="/high/GLSC/13.glsc_cart_service/" class="sidebar-link">商城高级-购物车消息订单</a></li><li><a href="/high/GLSC/14.glsc_sentinel/" aria-current="page" class="active sidebar-link">商城高级-Sentinel服务流控熔断降级</a></li><li><a href="/high/GLSC/15.glsc_zipkin/" class="sidebar-link">商城高级-Zipkin链路追踪</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=baodian" title="分类" data-v-06225672>baodian</a></li><li data-v-06225672><a href="/categories/?category=high" title="分类" data-v-06225672>high</a></li><li data-v-06225672><a href="/categories/?category=GLSC" title="分类" data-v-06225672>GLSC</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>lwy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-11-07</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">商城高级-Sentinel服务流控熔断降级<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="_1-熔断降级限流"><a href="#_1-熔断降级限流" class="header-anchor">#</a> 1 熔断降级限流</h2> <p></p><div class="table-of-contents"><ul><li><a href="#_1-熔断降级限流">1 熔断降级限流</a><ul><li><a href="#_1-1-什么是熔断">1.1 什么是熔断</a></li><li><a href="#_1-2-什么是降级">1.2 什么是降级</a></li><li><a href="#_1-3-异同">1.3 异同</a></li><li><a href="#_1-4-什么是限流">1.4 什么是限流</a></li></ul></li><li><a href="#_2-sentinel简介">2. Sentinel简介</a><ul><li><a href="#_2-1-特征">2.1 特征</a></li><li><a href="#_2-2-基本概念">2.2 基本概念</a></li><li><a href="#_2-3-sentinel与hystrix比较">2.3 Sentinel与Hystrix比较</a></li></ul></li><li><a href="#_3-基本使用-资源与规则">3. 基本使用 - 资源与规则</a><ul><li><a href="#_3-1-资源定义【多用方式1、2、4】">3.1 资源定义【多用方式1、2、4】</a></li><li><a href="#_3-2-定义规则">3.2 定义规则</a></li></ul></li><li><a href="#_4-其它-api">4. 其它 API</a><ul><li><a href="#_4-1-业务异常统计-tracer">4.1 业务异常统计 Tracer</a></li><li><a href="#_4-2-上下文工具类-contextutil">4.2 上下文工具类 ContextUtil</a></li><li><a href="#_4-3-指标统计配置">4.3 指标统计配置</a></li></ul></li><li><a href="#_5-dashboard">5. Dashboard</a></li><li><a href="#_6-sentinel整合springboot">6. Sentinel整合SpringBoot</a><ul><li><a href="#_6-1-开源框架适配">6.1 开源框架适配</a></li><li><a href="#_6-2-官方示例sentinel整合springboot">6.2 官方示例Sentinel整合SpringBoot</a></li><li><a href="#_6-3-导入依赖">6.3 导入依赖</a></li><li><a href="#_6-4-启动sentinel">6.4 启动sentinel</a></li><li><a href="#_6-5-相关配置">6.5 相关配置</a></li><li><a href="#_6-6-懒加载-访问的时候才会加载">6.6 懒加载，访问的时候才会加载</a></li><li><a href="#_6-7-实时监控图标显示">6.7 实时监控图标显示</a></li><li><a href="#_6-8-流控规则与效果">6.8 流控规则与效果</a></li></ul></li><li><a href="#_7-熔断降级">7. 熔断降级</a><ul><li><a href="#_7-1-使用sentinel来保护feign远程调用-熔断">7.1 使用sentinel来保护feign远程调用(熔断)</a></li></ul></li><li><a href="#_8-自定义受保护资源">8. 自定义受保护资源</a><ul><li><a href="#_8-1-主流框架的默认适配">8.1 主流框架的默认适配</a></li><li><a href="#_8-2-抛出异常的方式定义资源">8.2 抛出异常的方式定义资源</a></li><li><a href="#_8-3-注解方式定义资源">8.3 注解方式定义资源</a></li><li><a href="#_8-4-注意-以上三种方式一定要配置被限流后的默认返回-sentinelconfig">8.4 注意(以上三种方式一定要配置被限流后的默认返回) SentinelConfig</a></li></ul></li><li><a href="#_9-网关控流">9. 网关控流</a><ul><li><a href="#_9-1-为什么要网关控流">9.1 为什么要网关控流?</a></li><li><a href="#_9-2-为网关服务整合网关流控">9.2 为网关服务整合网关流控</a></li></ul></li></ul></div><p></p> <h3 id="_1-1-什么是熔断"><a href="#_1-1-什么是熔断" class="header-anchor">#</a> 1.1 什么是熔断</h3> <p>A 服务调用 B 服务的某个功能， 由于网络不稳定问题， 或者 B 服务卡机， 导致功能时间超长。 如果这样子的次数太多。 我们就可以直接将 B 断路了（A 不再请求 B 接口） ， 凡是调用 B 的直接返回降级数据， 不必等待 B 的超长执行。 这样 B 的故障问题， 就不会级联影响到 A。</p> <h3 id="_1-2-什么是降级"><a href="#_1-2-什么是降级" class="header-anchor">#</a> 1.2 什么是降级</h3> <p>整个网站处于流量高峰期， 服务器压力剧增， 根据当前业务情况及流量， 对一些服务和页面进行有策略的降级[停止服务， 所有的调用直接返回降级数据]。 以此缓解服务器资源的的压力， 以保证核心业务的正常运行， 同时也保持了客户和大部分客户的得到正确的相应。</p> <h3 id="_1-3-异同"><a href="#_1-3-异同" class="header-anchor">#</a> 1.3 异同</h3> <p>​	相同点：</p> <ul><li><p>为了保证集群大部分服务的可用性和可靠性， 防止崩溃， 牺牲小我</p></li> <li><p>用户最终都是体验到某个功能不可用</p> <p>不同点：</p></li> <li><p>熔断是被调用方故障， 触发的系统主动规则</p></li> <li><p>降级是基于全局考虑， 停止一些正常服务， 释放资源</p></li></ul> <h3 id="_1-4-什么是限流"><a href="#_1-4-什么是限流" class="header-anchor">#</a> 1.4 什么是限流</h3> <p>对打入服务的请求流量进行控制， 使服务能够承担不超过自己能力的流量压力</p> <h2 id="_2-sentinel简介"><a href="#_2-sentinel简介" class="header-anchor">#</a> 2. Sentinel简介</h2> <p>官方文档： https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D
项目地址： https://github.com/alibaba/Sentinel
随着微服务的流行， 服务和服务之间的稳定性变得越来越重要。 Sentinel 以流量为切入点，从流量控制、 熔断降级、 系统负载保护等多个维度保护服务的稳定性。</p> <h3 id="_2-1-特征"><a href="#_2-1-特征" class="header-anchor">#</a> 2.1 特征</h3> <ul><li>丰富的应用场景： Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景， 例如秒杀（即突发流量控制在系统容量可以承受的范围） 、 消息削峰填谷、 集群流量控制、 实时熔断下游不可用应用等。</li> <li>完备的实时监控： Sentinel 同时提供实时的监控功能。 您可以在控制台中看到接入应用的单台机器秒级数据， 甚至 500 台以下规模的集群的汇总运行情况。</li> <li>广泛的开源生态： Sentinel 提供开箱即用的与其它开源框架/库的整合模块， 例如与 Spring Cloud、 Dubbo、 gRPC 的整合。 您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</li> <li>完善的 SPI 扩展点： Sentinel 提供简单易用、 完善的 SPI 扩展接口。 您可以通过实现扩展接口来快速地定制逻辑。 例如定制规则管理、 适配动态数据源等。
<img alt="image-20220110164306865" data-src="/assets/img/590075a1ce0b0efdf18f9107db129e55.ca19a14f.png" loading="lazy" class="lazy"></li></ul> <p>Sentinel 分为两个部分 :</p> <p>核心库（Java 客户端） 不依赖任何框架/库， 能够运行于所有 Java 运行时环境， 同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</p> <p>控制台（ Dashboard） 基于 Spring Boot 开发， 打包后可以直接运行， 不需要额外的Tomcat 等应用容器。</p> <h3 id="_2-2-基本概念"><a href="#_2-2-基本概念" class="header-anchor">#</a> 2.2 基本概念</h3> <h4 id="_2-2-1-资源"><a href="#_2-2-1-资源" class="header-anchor">#</a> 2.2.1 资源</h4> <p>资源是 Sentinel 的关键概念。 它可以是 Java 应用程序中的任何内容， 例如， 由应用程序提供的服务， 或由应用程序调用的其它应用提供的服务， 甚至可以是一段代码。 在接下来的文档中， 我们都会用资源来描述代码块。</p> <p>只要通过 Sentinel API 定义的代码， 就是资源， 能够被 Sentinel 保护起来。 大部分情况下，可以使用方法签名， URL， 甚至服务名称作为资源名来标示资源。</p> <h4 id="_2-2-2-规则"><a href="#_2-2-2-规则" class="header-anchor">#</a> 2.2.2 规则</h4> <p>围绕资源的实时状态设定的规则， 可以包括<strong>流量控制规则</strong>、 <strong>熔断降级规则</strong>以及<strong>系统保护规则</strong>。 所有规则可以动态实时调整。</p> <h3 id="_2-3-sentinel与hystrix比较"><a href="#_2-3-sentinel与hystrix比较" class="header-anchor">#</a> 2.3 Sentinel与Hystrix比较</h3> <p><img alt="image-20220110165114710" data-src="assets/14.glsc_sentinel/3ef8adc5a66b56e2e9a22cf70aea423e.png" loading="lazy" class="lazy"></p> <h2 id="_3-基本使用-资源与规则"><a href="#_3-基本使用-资源与规则" class="header-anchor">#</a> 3. 基本使用 - 资源与规则</h2> <p>官方文档:https://sentinelguard.io/zh-cn/docs/basic-api-resource-rule.html</p> <p>我们说的资源，可以是任何东西，服务，服务里的方法，甚至是一段代码。使用 Sentinel 来进行资源保护，主要分为几个步骤:</p> <p>定义资源
定义规则
检验规则是否生效
先把可能需要保护的资源定义好，之后再配置规则。也可以理解为，只要有了资源，我们就可以在任何时候灵活地定义各种流量控制规则。在编码的时候，只需要考虑这个代码是否需要保护，如果需要保护，就将之定义为一个资源。</p> <p>对于主流的框架，我们提供适配，只需要按照适配中的说明配置，Sentinel 就会默认定义提供的服务，方法等为资源。</p> <h3 id="_3-1-资源定义【多用方式1、2、4】"><a href="#_3-1-资源定义【多用方式1、2、4】" class="header-anchor">#</a> 3.1 资源定义【多用方式1、2、4】</h3> <h4 id="方式一-主流框架的默认适配"><a href="#方式一-主流框架的默认适配" class="header-anchor">#</a> 方式一：主流框架的默认适配</h4> <p>为了减少开发的复杂程度，我们对大部分的主流框架，例如 Web Servlet、Dubbo、Spring Cloud、gRPC、Spring WebFlux、Reactor 等都做了适配。您只需要引入对应的依赖即可方便地整合 Sentinel。可以参见：</p> <p><a href="https://sentinelguard.io/zh-cn/docs/open-source-framework-integrations.html" target="_blank" rel="noopener noreferrer">主流框架的文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="方式二-抛出异常的方式定义资源"><a href="#方式二-抛出异常的方式定义资源" class="header-anchor">#</a> 方式二：抛出异常的方式定义资源</h4> <p><code>SphU</code> 包含了 try-catch 风格的 API。用这种方式，当资源发生了限流之后会抛出 <code>BlockException</code>。这个时候可以捕捉异常，进行限流之后的逻辑处理。示例代码如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1.5.0 版本开始可以利用 try-with-resources 特性</span>
<span class="token comment">// 资源名可使用任意有业务语义的字符串，比如方法名、接口名或其它可唯一标识的字符串。</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span> entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;resourceName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 被保护的业务逻辑</span>
  <span class="token comment">// do something here...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 资源访问阻止，被限流或被降级</span>
  <span class="token comment">// 在此处进行相应的处理操作</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>特别地，若 entry 的时候传入了热点参数，那么 exit 的时候也一定要带上对应的参数（exit(count, args)），否则可能会有统计错误。这个时候不能使用 try-with-resources 的方式。另外通过 Tracer.trace(ex) 来统计异常信息时，由于 try-with-resources 语法中 catch 调用顺序的问题，会导致无法正确统计异常数，因此统计异常信息时也不能在 try-with-resources 的 catch 块中调用 Tracer.trace(ex)。
1.5.0 之前的版本的示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Entry</span> entry <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 务必保证finally会被执行</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 资源名可使用任意有业务语义的字符串</span>
  entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;自定义资源名&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 被保护的业务逻辑</span>
  <span class="token comment">// do something...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 资源访问阻止，被限流或被降级</span>
  <span class="token comment">// 进行相应的处理操作</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>注意</strong>： SphU.entry(xxx) 需要与 entry.exit() 方法成对出现，匹配调用，否则会导致调用链记录异常，抛出 ErrorEntryFreeException 异常。</p> <h4 id="方式三-返回布尔值方式定义资源"><a href="#方式三-返回布尔值方式定义资源" class="header-anchor">#</a> 方式三：返回布尔值方式定义资源</h4> <p>SphO 提供 if-else 风格的 API。用这种方式，当资源发生了限流之后会返回 false，这个时候可以根据返回值，进行限流之后的逻辑处理。示例代码如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">// 资源名可使用任意有业务语义的字符串</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">SphO</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;自定义资源名&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 务必保证finally会被执行</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">/**
      * 被保护的业务逻辑
      */</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token class-name">SphO</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 资源访问阻止，被限流或被降级</span>
    <span class="token comment">// 进行相应的处理操作</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="方式四-注解方式定义资源"><a href="#方式四-注解方式定义资源" class="header-anchor">#</a> 方式四：注解方式定义资源</h4> <p>Sentinel 支持通过 <code>@SentinelResource</code> 注解定义资源并配置 <code>blockHandler</code> 和 <code>fallback</code> 函数来进行限流之后的处理。示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 原本的业务方法.</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>blockHandler <span class="token operator">=</span> <span class="token string">&quot;blockHandlerForGetUser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;getUserById command failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// blockHandler 函数，原方法调用被限流/降级/系统保护的时候调用</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">blockHandlerForGetUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>注意 <code>blockHandler</code> 函数会在原方法被限流/降级/系统保护的时候调用，而 <code>fallback</code> 函数会针对所有类型的异常。请注意 <code>blockHandler</code> 和 <code>fallback</code> 函数的形式要求，更多指引可以参见 <a href="https://sentinelguard.io/zh-cn/docs/annotation-support.html" target="_blank" rel="noopener noreferrer">Sentinel 注解支持文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="方式五-异步调用支持"><a href="#方式五-异步调用支持" class="header-anchor">#</a> 方式五：异步调用支持</h4> <p>Sentinel 支持异步调用链路的统计。在异步调用中，需要通过 <code>SphU.asyncEntry(xxx)</code> 方法定义资源，并通常需要在异步的回调函数中调用 <code>exit</code> 方法。以下是一个简单的示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">AsyncEntry</span> entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">asyncEntry</span><span class="token punctuation">(</span>resourceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 异步调用.</span>
    <span class="token function">doAsync</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 在此处处理异步调用的结果.</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// 在回调结束后 exit.</span>
            entry<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Request blocked.</span>
    <span class="token comment">// Handle the exception (e.g. retry or fallback).</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>SphU.asyncEntry(xxx)</code> 不会影响当前（调用线程）的 Context，因此以下两个 entry 在调用链上是平级关系（处于同一层），而不是嵌套关系：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 调用链类似于：</span>
<span class="token comment">// -parent</span>
<span class="token comment">// ---asyncResource</span>
<span class="token comment">// ---syncResource</span>
asyncEntry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">asyncEntry</span><span class="token punctuation">(</span>asyncResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>normalResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>若在异步回调中需要嵌套其它的资源调用（无论是 entry 还是 asyncEntry），只需要借助 Sentinel 提供的上下文切换功能，在对应的地方通过 ContextUtil.runOnContext(context, f) 进行 Context 变换，将对应资源调用处的 Context 切换为生成的异步 Context，即可维持正确的调用链路关系。示例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Entry</span> entry <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;handleResultForAsync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Handle your result here.</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Blocked for the result handler.</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            entry<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">someAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">AsyncEntry</span> entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">asyncEntry</span><span class="token punctuation">(</span>resourceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Asynchronous invocation.</span>
        <span class="token function">doAsync</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> result <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 在异步回调中进行上下文变换，通过 AsyncEntry 的 getAsyncContext 方法获取异步 Context</span>
            <span class="token class-name">ContextUtil</span><span class="token punctuation">.</span><span class="token function">runOnContext</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getAsyncContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 此处嵌套正常的资源调用.</span>
                    <span class="token function">handleResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    entry<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Request blocked.</span>
        <span class="token comment">// Handle the exception (e.g. retry or fallback).</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>此时的调用链就类似于：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>parent
<span class="token operator">--</span><span class="token operator">-</span>asyncInvocation
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>handleResultForAsync
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>更详细的示例可以参考 Demo 中的 <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/AsyncEntryDemo.java" target="_blank" rel="noopener noreferrer">AsyncEntryDemo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，里面包含了普通资源与异步资源之间的各种嵌套示例。</p> <h3 id="_3-2-定义规则"><a href="#_3-2-定义规则" class="header-anchor">#</a> 3.2 定义规则</h3> <h4 id="_3-2-1-规则的种类"><a href="#_3-2-1-规则的种类" class="header-anchor">#</a> 3.2.1 规则的种类</h4> <p>Sentinel 的所有规则都可以在内存态中动态地查询及修改，修改之后立即生效。同时 Sentinel 也提供相关 API，供您来定制自己的规则策略。</p> <p>Sentinel 支持以下几种规则：流量控制规则、熔断降级规则、系统保护规则、来源访问控制规则 和 热点参数规则。</p> <h5 id="_3-2-1-1-流量控制规则-flowrule"><a href="#_3-2-1-1-流量控制规则-flowrule" class="header-anchor">#</a> 3.2.1.1 流量控制规则 (FlowRule)</h5> <p>流量规则的定义
重要属性：</p> <table><thead><tr><th>Field</th> <th>说明</th> <th>默认值</th></tr></thead> <tbody><tr><td>resource</td> <td>资源名，资源名是限流规则的作用对象</td> <td></td></tr> <tr><td>count</td> <td>限流阈值</td> <td></td></tr> <tr><td>grade</td> <td>限流阈值类型，QPS 或线程数模式</td> <td>QPS 模式</td></tr> <tr><td>limitApp</td> <td>流控针对的调用来源</td> <td><code>default</code>，代表不区分调用来源</td></tr> <tr><td>strategy</td> <td>调用关系限流策略：直接、链路、关联</td> <td>根据资源本身（直接）</td></tr> <tr><td>controlBehavior</td> <td>流控效果（直接拒绝 / 排队等待 / 慢启动模式），不支持按调用关系限流</td> <td>直接拒绝</td></tr></tbody></table> <p>同一个资源可以同时有多个限流规则。</p> <p><strong>通过代码定义流量控制规则</strong></p> <p>理解上面规则的定义之后，我们可以通过调用 <code>FlowRuleManager.loadRules()</code> 方法来用硬编码的方式定义流量控制规则，比如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initFlowQpsRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FlowRule</span> rule1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlowRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rule1<span class="token punctuation">.</span><span class="token function">setResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set max qps to 20</span>
    rule1<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rule1<span class="token punctuation">.</span><span class="token function">setGrade</span><span class="token punctuation">(</span><span class="token class-name">RuleConstant</span><span class="token punctuation">.</span>FLOW_GRADE_QPS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rule1<span class="token punctuation">.</span><span class="token function">setLimitApp</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rule1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FlowRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>更多详细内容可以参考 <a href="https://sentinelguard.io/zh-cn/docs/flow-control.html" target="_blank" rel="noopener noreferrer">流量控制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h5 id="_3-2-1-2-熔断降级规则-degraderule"><a href="#_3-2-1-2-熔断降级规则-degraderule" class="header-anchor">#</a> 3.2.1.2 熔断降级规则 (DegradeRule)</h5> <p>熔断降级规则包含下面几个重要的属性：</p> <table><thead><tr><th>Field</th> <th>说明</th> <th>默认值</th></tr></thead> <tbody><tr><td>resource</td> <td>资源名，即规则的作用对象</td> <td></td></tr> <tr><td>grade</td> <td>熔断策略，支持慢调用比例/异常比例/异常数策略</td> <td>慢调用比例</td></tr> <tr><td>count</td> <td>慢调用比例模式下为慢调用临界 RT（超出该值计为慢调用）；异常比例/异常数模式下为对应的阈值</td> <td></td></tr> <tr><td>timeWindow</td> <td>熔断时长，单位为 s</td> <td></td></tr> <tr><td>minRequestAmount</td> <td>熔断触发的最小请求数，请求数小于该值时即使异常比率超出阈值也不会熔断（1.7.0 引入）</td> <td>5</td></tr> <tr><td>statIntervalMs</td> <td>统计时长（单位为 ms），如 60*1000 代表分钟级（1.8.0 引入）</td> <td>1000 ms</td></tr> <tr><td>slowRatioThreshold</td> <td>慢调用比例阈值，仅慢调用比例模式有效（1.8.0 引入）</td> <td></td></tr></tbody></table> <p>同一个资源可以同时有多个降级规则。</p> <p>理解上面规则的定义之后，我们可以通过调用 <code>DegradeRuleManager.loadRules()</code> 方法来用硬编码的方式定义流量控制规则。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initDegradeRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DegradeRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DegradeRule</span> rule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DegradeRule</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token function">setGrade</span><span class="token punctuation">(</span><span class="token class-name">CircuitBreakerStrategy</span><span class="token punctuation">.</span>ERROR_RATIO<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Threshold is 70% error ratio</span>
        <span class="token punctuation">.</span><span class="token function">setMinRequestAmount</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setStatIntervalMs</span><span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span> <span class="token comment">// 30s</span>
        <span class="token punctuation">.</span><span class="token function">setTimeWindow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DegradeRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>更多详情可以参考 <a href="https://sentinelguard.io/zh-cn/docs/circuit-breaking.html" target="_blank" rel="noopener noreferrer">熔断降级<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h5 id="_3-2-1-3-系统保护规则-systemrule"><a href="#_3-2-1-3-系统保护规则-systemrule" class="header-anchor">#</a> 3.2.1.3 系统保护规则 (SystemRule)</h5> <p>Sentinel 系统自适应限流从整体维度对应用入口流量进行控制，结合应用的 Load、CPU 使用率、总体平均 RT、入口 QPS 和并发线程数等几个维度的监控指标，通过自适应的流控策略，让系统的入口流量和系统的负载达到一个平衡，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。</p> <p>系统规则包含下面几个重要的属性：</p> <table><thead><tr><th>Field</th> <th>说明</th> <th>默认值</th></tr></thead> <tbody><tr><td>highestSystemLoad</td> <td><code>load1</code> 触发值，用于触发自适应控制阶段</td> <td>-1 (不生效)</td></tr> <tr><td>avgRt</td> <td>所有入口流量的平均响应时间</td> <td>-1 (不生效)</td></tr> <tr><td>maxThread</td> <td>入口流量的最大并发数</td> <td>-1 (不生效)</td></tr> <tr><td>qps</td> <td>所有入口资源的 QPS</td> <td>-1 (不生效)</td></tr> <tr><td>highestCpuUsage</td> <td>当前系统的 CPU 使用率（0.0-1.0）</td> <td>-1 (不生效)</td></tr></tbody></table> <p>理解上面规则的定义之后，我们可以通过调用 <code>SystemRuleManager.loadRules()</code> 方法来用硬编码的方式定义流量控制规则：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initSystemProtectionRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SystemRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SystemRule</span> rule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SystemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rule<span class="token punctuation">.</span><span class="token function">setHighestSystemLoad</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">SystemRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>更多详情可以参考 <a href="https://sentinelguard.io/zh-cn/docs/system-adaptive-protection.html" target="_blank" rel="noopener noreferrer">系统自适应保护<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h5 id="_3-2-1-4-访问控制规则-authorityrule"><a href="#_3-2-1-4-访问控制规则-authorityrule" class="header-anchor">#</a> 3.2.1.4 访问控制规则 (AuthorityRule)</h5> <p>很多时候，我们需要根据调用方来限制资源是否通过，这时候可以使用 Sentinel 的访问控制（黑白名单）的功能。黑白名单根据资源的请求来源（origin）限制资源是否通过，若配置白名单则只有请求来源位于白名单内时才可通过；若配置黑名单则请求来源位于黑名单时不通过，其余的请求通过。</p> <p>授权规则，即黑白名单规则（AuthorityRule）非常简单，主要有以下配置项：
授权规则，即黑白名单规则（AuthorityRule）非常简单，主要有以下配置项：</p> <ul><li>resource：资源名，即限流规则的作用对象</li> <li>limitApp：对应的黑名单/白名单，不同 origin 用 , 分隔，如 appA,appB</li> <li>strategy：限制模式，AUTHORITY_WHITE 为白名单模式，AUTHORITY_BLACK 为黑名单模式，默认为白名单模式</li></ul> <p>更多详情可以参考 <a href="https://sentinelguard.io/zh-cn/docs/origin-authority-control.html" target="_blank" rel="noopener noreferrer">来源访问控制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h5 id="_3-2-1-5-热点规则-paramflowrule"><a href="#_3-2-1-5-热点规则-paramflowrule" class="header-anchor">#</a> 3.2.1.5 热点规则 (ParamFlowRule)</h5> <p>详情可以参考 <a href="https://sentinelguard.io/zh-cn/docs/parameter-flow-control.html" target="_blank" rel="noopener noreferrer">热点参数限流<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="_3-2-2-查询更改规则"><a href="#_3-2-2-查询更改规则" class="header-anchor">#</a> 3.2.2 查询更改规则</h4> <p>引入了 transport 模块后，可以通过以下的 HTTP API 来获取所有已加载的规则：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8719</span><span class="token operator">/</span>getRules<span class="token operator">?</span>type<span class="token operator">=</span><span class="token generics"><span class="token punctuation">&lt;</span>XXXX<span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，<code>type=flow</code> 以 JSON 格式返回现有的限流规则，degrade 返回现有生效的降级规则列表，system 则返回系统保护规则。</p> <p>获取所有热点规则：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8719</span><span class="token operator">/</span>getParamRules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中，type 可以输入 <code>flow</code>、<code>degrade</code> 等方式来制定更改的规则种类，<code>data</code> 则是对应的 JSON 格式的规则。</p> <h4 id="_3-2-3-定制自己的持久化规则"><a href="#_3-2-3-定制自己的持久化规则" class="header-anchor">#</a> 3.2.3 定制自己的持久化规则</h4> <p>上面的规则配置，都是存在内存中的。即如果应用重启，这个规则就会失效。因此我们提供了开放的接口，您可以通过实现 DataSource 接口的方式，来自定义规则的存储数据源。通常我们的建议有：</p> <ul><li>整合动态配置系统，如 ZooKeeper、Nacos 等，动态地实时刷新配置规则</li> <li>结合 RDBMS、NoSQL、VCS 等来实现该规则</li> <li>配合 Sentinel Dashboard 使用
更多详情请参考 <a href="https://sentinelguard.io/zh-cn/docs/dynamic-rule-configuration.html" target="_blank" rel="noopener noreferrer">动态规则配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <h4 id="_3-2-4-规则生效的效果"><a href="#_3-2-4-规则生效的效果" class="header-anchor">#</a> 3.2.4 规则生效的效果</h4> <h5 id="_3-2-4-1-判断限流降级异常"><a href="#_3-2-4-1-判断限流降级异常" class="header-anchor">#</a> 3.2.4.1 判断限流降级异常</h5> <p>通过以下方法判断是否为 Sentinel 的流控降级异常：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">BlockException</span><span class="token punctuation">.</span><span class="token function">isBlockException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>除了在业务代码逻辑上看到规则生效，我们也可以通过下面简单的方法，来校验规则生效的效果：</p> <ul><li><strong>暴露的 HTTP 接口</strong>：通过运行下面命令 curl http://localhost:8719/cnode?id=&lt;资源名称&gt;，观察返回的数据。如果规则生效，在返回的数据栏中的 block 以及 block(m) 中会有显示</li> <li><strong>日志</strong>：Sentinel 提供秒级的资源运行日志以及限流日志，详情可以参考 <a href="https://sentinelguard.io/zh-cn/docs/logs.html" target="_blank" rel="noopener noreferrer">日志文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="_3-2-4-2-block-事件"><a href="#_3-2-4-2-block-事件" class="header-anchor">#</a> 3.2.4.2 block 事件</h5> <p>Sentinel 提供以下扩展接口，可以通过 StatisticSlotCallbackRegistry 向 StatisticSlot 注册回调函数：</p> <ul><li>ProcessorSlotEntryCallback: callback when resource entry passed (onPass) or blocked (onBlocked)</li> <li>ProcessorSlotExitCallback: callback when resource entry successfully completed (onExit)
可以利用这些回调接口来实现报警等功能，实时的监控信息可以从 ClusterNode 中实时获取。</li></ul> <h2 id="_4-其它-api"><a href="#_4-其它-api" class="header-anchor">#</a> 4. 其它 API</h2> <h3 id="_4-1-业务异常统计-tracer"><a href="#_4-1-业务异常统计-tracer" class="header-anchor">#</a> 4.1 业务异常统计 Tracer</h3> <p>业务异常记录类 Tracer 用于记录业务异常。相关方法：</p> <ul><li>trace(Throwable e)：记录业务异常（非 BlockException 异常），对应的资源为当前线程 context 下 entry 对应的资源。</li> <li>trace(Throwable e, int count)：记录业务异常（非 BlockException 异常），异常数目为传入的 count。</li> <li>traceEntry(Throwable, int, Entry)：向传入 entry 对应的资源记录业务异常（非 BlockException 异常），异常数目为传入的 count。
如果用户通过 SphU 或 SphO 手动定义资源，则 Sentinel 不能感知上层业务的异常，需要手动调用 Tracer.trace(ex) 来记录业务异常，否则对应的异常不会统计到 Sentinel 异常计数中。注意不要在 try-with-resources 形式的 SphU.entry(xxx) 中使用，否则会统计不上。</li></ul> <p>从 1.3.1 版本开始，注解方式定义资源支持自动统计业务异常，无需手动调用 Tracer.trace(ex) 来记录业务异常。Sentinel 1.3.1 以前的版本需要手动记录。</p> <h3 id="_4-2-上下文工具类-contextutil"><a href="#_4-2-上下文工具类-contextutil" class="header-anchor">#</a> 4.2 上下文工具类 ContextUtil</h3> <p>相关静态方法：</p> <p><strong>标识进入调用链入口（上下文）：</strong></p> <p>以下静态方法用于标识调用链路入口，用于区分不同的调用链路：</p> <ul><li>public static Context enter(String contextName)</li> <li>public static Context enter(String contextName, String origin)</li></ul> <p>其中 <code>contextName</code> 代表调用链路入口名称（上下文名称），<code>origin</code> 代表调用来源名称。默认调用来源为空。返回值类型为 <code>Context</code>，即生成的调用链路上下文对象。</p> <p><strong>注意</strong>：<code>ContextUtil.enter(xxx)</code>方法仅在调用链路入口处生效，即仅在当前线程的初次调用生效，后面再调用不会覆盖当前线程的调用链路，直到 exit。<code>Context</code> 存于 ThreadLocal 中，因此切换线程时可能会丢掉，如果需要跨线程使用可以结合 <code>runOnContext</code> 方法使用。</p> <p>流控规则中若选择“流控方式”为“链路”方式，则入口资源名即为上面的 <code>contextName</code>。</p> <p><strong>退出调用链（清空上下文）：</strong></p> <ul><li><code>public static void exit()</code>：该方法用于退出调用链，清理当前线程的上下文。</li></ul> <p><strong>获取当前线程的调用链上下文：</strong></p> <ul><li><code>public static Context getContext()</code>：获取当前线程的调用链路上下文对象。</li></ul> <p><strong>在某个调用链上下文中执行代码：</strong></p> <ul><li><code>public static void runOnContext(Context context, Runnable f)</code>：常用于异步调用链路中 context 的变换。</li></ul> <h3 id="_4-3-指标统计配置"><a href="#_4-3-指标统计配置" class="header-anchor">#</a> 4.3 指标统计配置</h3> <p>Sentinel 底层采用高性能的滑动窗口数据结构来统计实时的秒级指标数据，并支持对滑动窗口进行配置。主要有以下两个配置：</p> <ul><li><code>windowIntervalMs</code>：滑动窗口的总的时间长度，默认为 1000 ms</li> <li><code>sampleCount</code>：滑动窗口划分的格子数目，默认为 2；格子越多则精度越高，但是内存占用也会越多</li></ul> <p><img alt="sliding-window-leap-array" data-src="/assets/img/5086dc1e0b09e618bec059cb9a1a64ba.ea5ebc23.png" loading="lazy" class="lazy"></p> <p>我们可以通过 <code>SampleCountProperty</code> 来动态地变更滑动窗口的格子数目，通过 <code>IntervalProperty</code> 来动态地变更滑动窗口的总时间长度。注意这两个配置都是<strong>全局生效</strong>的，会影响所有资源的所有指标统计。</p> <h2 id="_5-dashboard"><a href="#_5-dashboard" class="header-anchor">#</a> 5. Dashboard</h2> <p>详情请参考：<a href="https://sentinelguard.io/zh-cn/docs/dashboard.html" target="_blank" rel="noopener noreferrer">Sentinel Dashboard 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="_6-sentinel整合springboot"><a href="#_6-sentinel整合springboot" class="header-anchor">#</a> 6. Sentinel整合SpringBoot</h2> <h3 id="_6-1-开源框架适配"><a href="#_6-1-开源框架适配" class="header-anchor">#</a> 6.1 开源框架适配</h3> <p>https://sentinelguard.io/zh-cn/docs/open-source-framework-integrations.html</p> <h3 id="_6-2-官方示例sentinel整合springboot"><a href="#_6-2-官方示例sentinel整合springboot" class="header-anchor">#</a> 6.2 官方示例Sentinel整合SpringBoot</h3> <p>https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</p> <h3 id="_6-3-导入依赖"><a href="#_6-3-导入依赖" class="header-anchor">#</a> 6.3 导入依赖</h3> <blockquote><p>所有服务都需要被监控,所以在common导入sentinel</p> <p>gulimall-common/pom.xml</p></blockquote> <div class="language-pom line-numbers-mode"><pre class="language-text"><code>        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
        &lt;/dependency&gt;	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>查看导入sentinel-core版本,下载对应版本的jar包</p></blockquote> <p><img alt="image-20220110174000667" data-src="/assets/img/c69e4f9b854e9a054085f1a2ba6d6e2c.f2f8c25b.png" loading="lazy" class="lazy"></p> <p><img alt="image-20220110174644123" data-src="/assets/img/9c0c260131fe452771802df5978ea2db.0667a1a6.png" loading="lazy" class="lazy"></p> <h3 id="_6-4-启动sentinel"><a href="#_6-4-启动sentinel" class="header-anchor">#</a> 6.4 启动sentinel</h3> <p>sentinel默认占用8080端口,启动时换个端口</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -jar sentinel-dashboard-1.6.3.jar --server.port<span class="token operator">=</span><span class="token number">8333</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>访问localhost:8333</p></blockquote> <p><img alt="image-20220110175205657" data-src="/assets/img/3e6c8c8a3c7b7fe8f3b88371f2423c77.c321f9b3.png" loading="lazy" class="lazy"></p> <blockquote><p>默认账号密码都是:sentinel</p></blockquote> <blockquote><p>登录成功后</p> <p>懒加载，访问的时候才会加载</p> <p>在Dashboard中的配置是保存在内存中，重启后失效</p></blockquote> <p><img alt="image-20220110175238800" data-src="/assets/img/40f73f1c8d3ab26dcc58cfba2a069279.358eccb5.png" loading="lazy" class="lazy"></p> <h3 id="_6-5-相关配置"><a href="#_6-5-相关配置" class="header-anchor">#</a> 6.5 相关配置</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
      <span class="token comment">#控制台地址</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8333</span>
        <span class="token comment">#端口</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8791</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_6-6-懒加载-访问的时候才会加载"><a href="#_6-6-懒加载-访问的时候才会加载" class="header-anchor">#</a> 6.6 懒加载，访问的时候才会加载</h3> <p>跑一边业务流程</p> <p><img alt="image-20220111093818436" data-src="/assets/img/e3a12ee5182daa18d387f3272c728743.adacd4fa.png" loading="lazy" class="lazy"></p> <h3 id="_6-7-实时监控图标显示"><a href="#_6-7-实时监控图标显示" class="header-anchor">#</a> 6.7 实时监控图标显示</h3> <blockquote><p>未配置时,事实监控没有数据</p></blockquote> <p><img alt="image-20220111094030661" data-src="/assets/img/06ea0d11bd9608ca7979a30aff37063a.cd4c492c.png" loading="lazy" class="lazy"></p> <h4 id="_6-7-1-为需要监控的服务导入依赖"><a href="#_6-7-1-为需要监控的服务导入依赖" class="header-anchor">#</a> 6.7.1 为需要监控的服务导入依赖</h4> <div class="language-pom line-numbers-mode"><pre class="language-text"><code>		&lt;!--springboot 收集健康状况信息，提供给sentinel使用--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_6-7-2-配置事实监控"><a href="#_6-7-2-配置事实监控" class="header-anchor">#</a> 6.7.2 配置事实监控</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">'*'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_6-7-3-配置相关流控规则"><a href="#_6-7-3-配置相关流控规则" class="header-anchor">#</a> 6.7.3 配置相关流控规则</h4> <p><img alt="image-20220111101654654" data-src="/assets/img/fffbcd5a429dce6d56989ec578eedad5.2763108a.png" loading="lazy" class="lazy"></p> <blockquote><p>访问被流控的资源</p></blockquote> <p><img alt="image-20220111101509279" data-src="/assets/img/5ee51763668b74e88e5e0ec1c088e197.bef12888.png" loading="lazy" class="lazy"></p> <h3 id="_6-8-流控规则与效果"><a href="#_6-8-流控规则与效果" class="header-anchor">#</a> 6.8 流控规则与效果</h3> <p><img alt="image-20220111102329391" data-src="/assets/img/94c3c52d2c7248624a049223e4d99df2.bf7b9bd4.png" loading="lazy" class="lazy"></p> <h4 id="_6-8-1-流控模式"><a href="#_6-8-1-流控模式" class="header-anchor">#</a> 6.8.1 流控模式</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1</span>、直接
<span class="token number">2</span>、关联
	<span class="token class-name">A</span>限流，<span class="token class-name">A</span>关联<span class="token class-name">B</span>，如果<span class="token class-name">B</span>的流量大就对<span class="token class-name">A</span>限流，否则不限
<span class="token number">3</span>、链路
	入口限流，只有从这个入口开始的请求，才会被限制
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_6-8-2-流控效果"><a href="#_6-8-2-流控效果" class="header-anchor">#</a> 6.8.2 流控效果</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1</span>、快速失败
	直接拒绝抛出异常
<span class="token number">2</span>、<span class="token class-name">Warm</span> <span class="token class-name">Up</span>
	预热启动，例如给定<span class="token number">10</span>S，<span class="token number">10</span>S内才将请求增加到阈值<span class="token number">500</span>，不会一次性放行<span class="token number">500</span>个
<span class="token number">3</span>、排队等待
	如果限制阈值<span class="token number">500</span>，此时来了<span class="token number">700</span>个请求，<span class="token number">500</span>个直接放行，剩下<span class="token number">200</span>排队【可以设置超时时间，<span class="token number">3</span>S内得不到处理也是失败】
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>快速失败的效果</p></blockquote> <p><img alt="image-20220111102451838" data-src="/assets/img/4a5d15e9b86cfe770a11d5c74e4cf0ee.94efd965.png" loading="lazy" class="lazy"></p> <h4 id="_6-8-3-自定义流控响应"><a href="#_6-8-3-自定义流控响应" class="header-anchor">#</a> 6.8.3 自定义流控响应</h4> <blockquote><p>gulimall-seckill/src/main/java/site/zhourui/gulimall/seckill/config/SeckillSentinelConfig.java</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>seckill<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">UrlBlockHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">WebCallbackManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span>JSON<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author zr
 * @date 2022/1/11 10:40
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeckillSentinelConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SeckillSentinelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">WebCallbackManager</span><span class="token punctuation">.</span><span class="token function">setUrlBlockHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UrlBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">blocked</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> error <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解决中文乱码</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><blockquote><p>测试效果</p></blockquote> <p><img alt="image-20220111105438169" data-src="/assets/img/a257033ba07a48551ab168b206dca931.662ee098.png" loading="lazy" class="lazy"></p> <h2 id="_7-熔断降级"><a href="#_7-熔断降级" class="header-anchor">#</a> 7. 熔断降级</h2> <h3 id="_7-1-使用sentinel来保护feign远程调用-熔断"><a href="#_7-1-使用sentinel来保护feign远程调用-熔断" class="header-anchor">#</a> 7.1 使用sentinel来保护feign远程调用(熔断)</h3> <h4 id="_7-1-1-在服务的调用方指定降级策略"><a href="#_7-1-1-在服务的调用方指定降级策略" class="header-anchor">#</a> 7.1.1 在服务的调用方指定降级策略</h4> <h5 id="_7-1-1-1-开启调用方的熔断保护"><a href="#_7-1-1-1-开启调用方的熔断保护" class="header-anchor">#</a> 7.1.1.1 开启调用方的熔断保护</h5> <p><strong>场景：gulimall-product服务调用gulimall-seckill服务</strong></p> <blockquote><p>开启sentinel监控并熔断feign调用</p> <p>gulimall-product/src/main/resources/application.yml</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>在控制台就可以看到feign远程调用的链路信息</p></blockquote> <p><img alt="image-20220111133837370" data-src="/assets/img/670db632b3c896cb814e9df0e6ea3a27.1365fd1a.png" loading="lazy" class="lazy"></p> <h5 id="_7-1-1-2-编写熔断方法的具体实现"><a href="#_7-1-1-2-编写熔断方法的具体实现" class="header-anchor">#</a> 7.1.1.2 编写熔断方法的具体实现</h5> <blockquote><p>熔断方法的具体实现，也可以是降级方法的具体实现</p> <p>gulimall-product/src/main/java/site/zhourui/gulimall/product/fallback/SeckillFeignServiceFallBack.java</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>fallback</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>feign<span class="token punctuation">.</span></span><span class="token class-name">SeckillFeignService</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 熔断方法的具体实现，也可以是降级方法的具体实现
 * @author zr
 * @date 2022/1/11 11:50
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeckillFeignServiceFallBack</span> <span class="token keyword">implements</span> <span class="token class-name">SeckillFeignService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getSkuSeckilInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;熔断方法调用...getSkuSeckilInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_7-1-1-3-远程接口指定熔断后的本地默认实现"><a href="#_7-1-1-3-远程接口指定熔断后的本地默认实现" class="header-anchor">#</a> 7.1.1.3 远程接口指定熔断后的本地默认实现</h5> <p><img alt="image-20220111134914459" data-src="/assets/img/26a723ce4e33374453252a8533362883.8e369ec5.png" loading="lazy" class="lazy"></p> <blockquote><p>gulimall-product/src/main/java/site/zhourui/gulimall/product/feign/SeckillFeignService.java</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>feign</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">SeckillFeignServiceFallBack</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author zr
 * @date 2022/1/9 17:15
 */</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;gulimall-seckill&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">SeckillFeignServiceFallBack</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SeckillFeignService</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 根据skuId查询商品是否参加秒杀活动
     * @param skuId
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/sku/seckill/{skuId}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">R</span> <span class="token function">getSkuSeckilInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img alt="image-20220111135148159" data-src="/assets/img/0a1efb772b43f1dd63df6a6e13cc3e23.20fd7baa.png" loading="lazy" class="lazy"></p> <h5 id="_7-1-1-4-调用方手动指定远程服务的降级策略"><a href="#_7-1-1-4-调用方手动指定远程服务的降级策略" class="header-anchor">#</a> 7.1.1.4 调用方手动指定远程服务的降级策略</h5> <p>7.1.1.4.1 RT</p> <blockquote><p>RT指定1ms
如果1S内进来5个请求，每个对应的平均响应时间都超过阈值1ms，则在接下来的10s内会熔断该资源
并且回调本地的熔断回调方法</p></blockquote> <p><img alt="image-20220111135306526" data-src="/assets/img/af8fd077f236bbb35f28158069fcf328.4f25ca16.png" loading="lazy" class="lazy"></p> <h5 id="_7-1-1-5-测试熔断"><a href="#_7-1-1-5-测试熔断" class="header-anchor">#</a> 7.1.1.5 测试熔断</h5> <blockquote><p>疯狂刷新商品详情页(模拟高并发),直到控制台出现熔断日志后停止,大概在10s后再次慢速刷新几次(模拟正常访问)</p></blockquote> <p><img alt="image-20220111135743966" data-src="/assets/img/684c01d1d638657b9999b3137f155449.5fc73c8d.png" loading="lazy" class="lazy"></p> <h4 id="_7-1-2-在服务的提供方-远程服务-指定降级策略"><a href="#_7-1-2-在服务的提供方-远程服务-指定降级策略" class="header-anchor">#</a> 7.1.2 在服务的提供方（远程服务）指定降级策略</h4> <blockquote><p>超大浏览的时候，必须牺牲一些远程服务。在服务的提供方（远程服务）指定降级策略；</p> <p>提供方是在运行，但是不允许自己的业务逻辑，返回的是默认的降级数据（限流的数据）</p></blockquote> <p><strong>降级一般是主动【调用自定义返回数据】</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>例如商品详情页查询秒杀商品信息，秒杀系统对资源做了降级处理，返回的是本地默认实现
降级与熔断的区别就是，降级是主动的，提供方未宕机
				  熔断是被动的，提供方宕机
				  
因为降级的回调方法与熔断不同，与限流的自定义返回是一致的，所以这里复制<span class="token class-name">SentinelConfig</span>类给每一个微服务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_7-1-2-1-对服务提供方进行降级"><a href="#_7-1-2-1-对服务提供方进行降级" class="header-anchor">#</a> 7.1.2.1 对服务提供方进行降级</h5> <p><img alt="image-20220111142317907" data-src="/assets/img/10ea7ca2be835aee57e55897d4d0ff4e.d4295c4e.png" loading="lazy" class="lazy"></p> <h5 id="_7-1-2-2-自定义配置降级策略"><a href="#_7-1-2-2-自定义配置降级策略" class="header-anchor">#</a> 7.1.2.2 自定义配置降级策略</h5> <blockquote><p>之前配置过就不用配置了</p></blockquote> <p><img alt="image-20220111142514448" data-src="/assets/img/c436cbf2fb8daebfca8fda81a8377d49.0ed00a68.png" loading="lazy" class="lazy"></p> <h5 id="_7-1-2-3-测试"><a href="#_7-1-2-3-测试" class="header-anchor">#</a> 7.1.2.3 测试</h5> <blockquote><p>疯狂刷新,模拟大访问量,直到出现降级返回结果</p> <p>http://seckill.gulimall.com/getCurrentSeckillSkus</p></blockquote> <p><img alt="image-20220111142726636" data-src="/assets/img/e5b588de79a4fe5c5fb414af4e9c0f25.32abed70.png" loading="lazy" class="lazy"></p> <blockquote><p>等待大概10s,再次刷新,服务正常</p></blockquote> <p><img alt="image-20220111142853347" data-src="/assets/img/ae290d5a90eab287411f55095484f0e2.99434a76.png" loading="lazy" class="lazy"></p> <h2 id="_8-自定义受保护资源"><a href="#_8-自定义受保护资源" class="header-anchor">#</a> 8. 自定义受保护资源</h2> <h3 id="_8-1-主流框架的默认适配"><a href="#_8-1-主流框架的默认适配" class="header-anchor">#</a> 8.1 主流框架的默认适配</h3> <blockquote><p>以下资源我们都没有定义,这些就是默认适配的资源</p> <p>Spring Cloud Alibaba 默认为 Sentinel 整合了 Servlet、RestTemplate、FeignClient 和 Spring WebFlux。Sentinel 在 Spring Cloud 生态中，不仅补全了 Hystrix 在 Servlet 和 RestTemplate 这一块的空白，而且还完全兼容了 Hystrix 在 FeignClient 中限流降级的用法，并且支持运行时灵活地配置和调整限流降级规则</p></blockquote> <p><img alt="image-20220111143731464" data-src="/assets/img/e4ae91d42d1d7aac5367e5b856b00850.c4e5a21b.png" loading="lazy" class="lazy"></p> <h3 id="_8-2-抛出异常的方式定义资源"><a href="#_8-2-抛出异常的方式定义资源" class="header-anchor">#</a> 8.2 抛出异常的方式定义资源</h3> <p><code>SphU</code> 包含了 try-catch 风格的 API。用这种方式，当资源发生了限流之后会抛出 <code>BlockException</code>。这个时候可以捕捉异常，进行限流之后的逻辑处理。示例代码如下:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1.5.0 版本开始可以利用 try-with-resources 特性</span>
<span class="token comment">// 资源名可使用任意有业务语义的字符串，比如方法名、接口名或其它可唯一标识的字符串。</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span> entry <span class="token operator">=</span> <span class="token class-name">SphU</span><span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;resourceName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 被保护的业务逻辑</span>
  <span class="token comment">// do something here...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 资源访问阻止，被限流或被降级</span>
  <span class="token comment">// 在此处进行相应的处理操作</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>特别地</strong>，若 entry 的时候传入了热点参数，那么 exit 的时候也一定要带上对应的参数（<code>exit(count, args</code>)），否则可能会有统计错误。这个时候不能使用 try-with-resources 的方式。另外通过 <code>Tracer.trace(ex)</code> 来统计异常信息时，由于 try-with-resources 语法中 catch 调用顺序的问题，会导致无法正确统计异常数，因此统计异常信息时也不能在 try-with-resources 的 catch 块中调用 <code>Tracer.trace(ex)</code>。</p> <h4 id="_8-2-1-测试"><a href="#_8-2-1-测试" class="header-anchor">#</a> 8.2.1 测试</h4> <p><img alt="image-20220111144630427" data-src="/assets/img/e2a227b4e5f14c4535c2b146c79a40f4.00497a78.png" loading="lazy" class="lazy"></p> <blockquote><p>控制台中展示了我们自定义的受保护资源</p></blockquote> <p><img alt="image-20220111144540028" data-src="/assets/img/04f864b480ebace7994a8547041ccf66.62ac1737.png" loading="lazy" class="lazy"></p> <h3 id="_8-3-注解方式定义资源"><a href="#_8-3-注解方式定义资源" class="header-anchor">#</a> 8.3 注解方式定义资源</h3> <p><strong>@SentinelResource 注解</strong></p> <blockquote><p>注意：注解方式埋点不支持 private 方法。</p></blockquote> <p>@SentinelResource 用于定义资源，并提供可选的异常处理和 fallback 配置项。 @SentinelResource 注解包含以下属性：</p> <ul><li><p>value：资源名称，必需项（不能为空）</p></li> <li><p>entryType：entry 类型，可选项（默认为 EntryType.OUT）</p></li> <li><p>blockHandler / blockHandlerClass: blockHandler 对应处理 BlockException 的函数名称，可选项。</p></li> <li><p>blockHandler 函数访问范围需要是 public，返回类型需要与原方法相匹配，参数类型需要和原方法相匹配并且最后加一个额外的参数，类型为 BlockException。blockHandler 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定 blockHandlerClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否则无法解析。</p></li> <li><p>fallback：fallback 函数名称，可选项，用于在抛出异常的时候提供 fallback 处理逻辑。fallback 函数可以针对所有类型的异常（除了exceptionsToIgnore里面排除掉的异常类型）进行处理。fallback 函数签名和位置要求：
返回值类型必须与原函数返回值类型一致；
方法参数列表需要和原函数一致，或者可以额外多一个 Throwable 类型的参数用于接收对应的异常。
fallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否则无法解析。</p></li> <li><p>defaultFallback（since 1.6.0）：默认的 fallback 函数名称，可选项，通常用于通用的 fallback 逻辑（即可以用于很多服务或方法）。默认 fallback 函数可以针对所以类型的异常（除了exceptionsToIgnore里面排除掉的异常类型）进行处理。若同时配置了 fallback 和 defaultFallback，则只有 fallback 会生效。defaultFallback 函数签名要求：</p> <p>返回值类型必须与原函数返回值类型一致；
方法参数列表需要为空，或者可以额外多一个 Throwable 类型的参数用于接收对应的异常。
defaultFallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否则无法解析。
exceptionsToIgnore（since 1.6.0）：用于指定哪些异常被排除掉，不会计入异常统计中，也不会进入 fallback 逻辑中，而是会原样抛出。</p></li></ul> <blockquote><p>注：1.6.0 之前的版本 fallback 函数只针对降级异常（<code>DegradeException</code>）进行处理，<strong>不能针对业务异常进行处理</strong>。</p></blockquote> <p>特别地，若 blockHandler 和 fallback 都进行了配置，则被限流降级而抛出 <code>BlockException</code> 时只会进入 <code>blockHandler</code> 处理逻辑。若未配置 <code>blockHandler</code>、<code>fallback</code> 和 <code>defaultFallback</code>，则被限流降级时会将<code>BlockException</code> 直接抛出。</p> <p>示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对应的 `handleException` 函数需要位于 `ExceptionUtil` 类中，并且必须为 static 函数.</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;handleException&quot;</span><span class="token punctuation">,</span> blockHandlerClass <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 原函数</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">&quot;exceptionHandler&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">&quot;helloFallback&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token keyword">long</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hello at %d&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Fallback 函数，函数签名与原函数一致或加一个 Throwable 类型的参数.</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloFallback</span><span class="token punctuation">(</span><span class="token keyword">long</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Halooooo %d&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Block 异常处理函数，参数最后多一个 BlockException，其余与原函数一致.</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">long</span> s<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Do some log here.</span>
        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Oops, error occurred at &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>从 1.4.0 版本开始，注解方式定义资源支持自动统计业务异常，无需手动调用 <code>Tracer.trace(ex)</code> 来记录业务异常。Sentinel 1.4.0 以前的版本需要自行调用 <code>Tracer.trace(ex)</code> 来记录业务异常。</p> <h4 id="_3-3-1-测试"><a href="#_3-3-1-测试" class="header-anchor">#</a> 3.3.1 测试</h4> <p><img alt="image-20220111150126016" data-src="/assets/img/d96ab14ddf4a5ef33e1a7439b03a24bc.a4f2bb5f.png" loading="lazy" class="lazy"></p> <blockquote><p>加上<code>@SentinelResource</code>后就被找到了</p></blockquote> <p><img alt="image-20220111145603206" data-src="/assets/img/182f227d0a5d14e04e8b9e2a1323aea7.91631f24.png" loading="lazy" class="lazy"></p> <h4 id="_3-3-2-自定义保护资源限流后报错问题"><a href="#_3-3-2-自定义保护资源限流后报错问题" class="header-anchor">#</a> 3.3.2 自定义保护资源限流后报错问题</h4> <blockquote><p>对自定义保护资源限流</p></blockquote> <p><img alt="image-20220111150506291" data-src="/assets/img/ea37894ebb8586a735940e8acb37320d.42081eb1.png" loading="lazy" class="lazy"></p> <blockquote><p>疯狂刷新,出现以下错误</p> <p>http://seckill.gulimall.com/getCurrentSeckillSkus</p></blockquote> <p><img alt="image-20220111150615027" data-src="/assets/img/48ac49657193d318474ea39c0991e61f.49210d91.png" loading="lazy" class="lazy"></p> <h5 id="_3-3-2-1-解决方案-设置blockhandler"><a href="#_3-3-2-1-解决方案-设置blockhandler" class="header-anchor">#</a> 3.3.2.1 解决方案(设置blockHandler)</h5> <p><img alt="image-20220111151018564" data-src="/assets/img/46996013b4a2386c203f847d19d7a7eb.51258f1b.png" loading="lazy" class="lazy"></p> <blockquote><p>再次限流测试</p></blockquote> <p><img alt="image-20220111151049596" data-src="/assets/img/7118487ac9267f941a8998b6548390a8.70a6a98b.png" loading="lazy" class="lazy"></p> <h3 id="_8-4-注意-以上三种方式一定要配置被限流后的默认返回-sentinelconfig"><a href="#_8-4-注意-以上三种方式一定要配置被限流后的默认返回-sentinelconfig" class="header-anchor">#</a> 8.4 注意(以上三种方式一定要配置被限流后的默认返回) SentinelConfig</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author zr
 * @date 2022/1/11 10:40
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">SeckillSentinelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">WebCallbackManager</span><span class="token punctuation">.</span><span class="token function">setUrlBlockHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UrlBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">blocked</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> error <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                httpServletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_9-网关控流"><a href="#_9-网关控流" class="header-anchor">#</a> 9. 网关控流</h2> <p>Sentinel 支持对 Spring Cloud Gateway、Zuul 等主流的 API Gateway 进行限流。</p> <p><img alt="https://user-images.githubusercontent.com/9434884/58381714-266d7980-7ff3-11e9-8617-d0d7c325d703.png" data-src="/assets/img/4f9fbe909aef992b3c239d7983366682.e7dedcb9.png" loading="lazy" class="lazy"></p> <p>Sentinel 1.6.0 引入了 Sentinel API Gateway Adapter Common 模块，此模块中包含网关限流的规则和自定义 API 的实体和管理逻辑：</p> <p>GatewayFlowRule：网关限流规则，针对 API Gateway 的场景定制的限流规则，可以针对不同 route 或自定义的 API 分组进行限流，支持针对请求中的参数、Header、来源 IP 等进行定制化的限流。
ApiDefinition：用户自定义的 API 定义分组，可以看做是一些 URL 匹配的组合。比如我们可以定义一个 API 叫 my_api，请求 path 模式为 /foo/** 和 /baz/** 的都归到 my_api 这个 API 分组下面。限流的时候可以针对这个自定义的 API 分组维度进行限流。
其中网关限流规则 GatewayFlowRule 的字段解释如下：</p> <p>resource：资源名称，可以是网关中的 route 名称或者用户自定义的 API 分组名称。
resourceMode：规则是针对 API Gateway 的 route（RESOURCE_MODE_ROUTE_ID）还是用户在 Sentinel 中定义的 API 分组（RESOURCE_MODE_CUSTOM_API_NAME），默认是 route。
grade：限流指标维度，同限流规则的 grade 字段。
count：限流阈值
intervalSec：统计时间窗口，单位是秒，默认是 1 秒。
controlBehavior：流量整形的控制效果，同限流规则的 controlBehavior 字段，目前支持快速失败和匀速排队两种模式，默认是快速失败。
burst：应对突发请求时额外允许的请求数目。
maxQueueingTimeoutMs：匀速排队模式下的最长排队时间，单位是毫秒，仅在匀速排队模式下生效。
paramItem：参数限流配置。若不提供，则代表不针对参数进行限流，该网关规则将会被转换成普通流控规则；否则会转换成热点规则。其中的字段：
parseStrategy：从请求中提取参数的策略，目前支持提取来源 IP（PARAM_PARSE_STRATEGY_CLIENT_IP）、Host（PARAM_PARSE_STRATEGY_HOST）、任意 Header（PARAM_PARSE_STRATEGY_HEADER）和任意 URL 参数（PARAM_PARSE_STRATEGY_URL_PARAM）四种模式。
fieldName：若提取策略选择 Header 模式或 URL 参数模式，则需要指定对应的 header 名称或 URL 参数名称。
pattern：参数值的匹配模式，只有匹配该模式的请求属性值会纳入统计和流控；若为空则统计该请求属性的所有值。（1.6.2 版本开始支持）
matchStrategy：参数值的匹配策略，目前支持精确匹配（PARAM_MATCH_STRATEGY_EXACT）、子串匹配（PARAM_MATCH_STRATEGY_CONTAINS）和正则匹配（PARAM_MATCH_STRATEGY_REGEX）。（1.6.2 版本开始支持）
用户可以通过 GatewayRuleManager.loadRules(rules) 手动加载网关规则，或通过 GatewayRuleManager.register2Property(property) 注册动态规则源动态推送（推荐方式）。</p> <h3 id="_9-1-为什么要网关控流"><a href="#_9-1-为什么要网关控流" class="header-anchor">#</a> 9.1 为什么要网关控流?</h3> <p><strong>如果能在网关层就进行流控，可以避免请求流入业务，减小服务压力</strong></p> <h3 id="_9-2-为网关服务整合网关流控"><a href="#_9-2-为网关服务整合网关流控" class="header-anchor">#</a> 9.2 为网关服务整合网关流控</h3> <h4 id="_9-2-1-导入依赖"><a href="#_9-2-1-导入依赖" class="header-anchor">#</a> 9.2.1 导入依赖</h4> <blockquote><p>gulimall-gateway/pom.xml</p></blockquote> <div class="language-pom line-numbers-mode"><pre class="language-text"><code>        &lt;!-- 引入sentinel网关限流 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-alibaba-sentinel-gateway&lt;/artifactId&gt;
            &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_9-2-2-配置网关限流"><a href="#_9-2-2-配置网关限流" class="header-anchor">#</a> 9.2.2 配置网关限流</h4> <blockquote><p>此处需要安装sentinel1.7.1.jar客户端才能看到效果</p></blockquote> <blockquote><p>对gulimall_seckill_route进行限制</p></blockquote> <p><img alt="image-20220111160614858" data-src="/assets/img/ae75db120df5f5777ce7c8b7cc124a22.9b049583.png" loading="lazy" class="lazy"></p> <blockquote><p>疯狂访问http://seckill.gulimall.com/getCurrentSeckillSkus测试</p></blockquote> <p><img alt="image-20220111155930331" data-src="/assets/img/68c1f16940c5bc397b481dee7b3ee6a0.93d57818.png" loading="lazy" class="lazy"></p> <h4 id="_9-2-3-针对请求属性限流"><a href="#_9-2-3-针对请求属性限流" class="header-anchor">#</a> 9.2.3 针对请求属性限流</h4> <blockquote><p>开启针对参数属性限流</p></blockquote> <p><img alt="image-20220111161026514" data-src="/assets/img/1ab6478584061940fcefdb964e386e17.f758a608.png" loading="lazy" class="lazy"></p> <h4 id="_9-2-4-定制网关流控返回"><a href="#_9-2-4-定制网关流控返回" class="header-anchor">#</a> 9.2.4 定制网关流控返回</h4> <blockquote><p>gulimall-gateway/src/main/java/site/zhourui/gulimall/gateway/config/SentinelGatewayConfig.java</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>sc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">BlockRequestHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>sc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">GatewayCallbackManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span>JSON<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">site<span class="token punctuation">.</span>zhourui<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 自定义阻塞返回方法
 * @author zr
 * @date 2022/1/11 16:30
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelGatewayConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO 响应式编程</span>
    <span class="token keyword">public</span> <span class="token class-name">SentinelGatewayConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GatewayCallbackManager</span><span class="token punctuation">.</span><span class="token function">setBlockHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlockRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 网关限流了请求，就会调用此回调</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> serverWebExchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> error <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> errJson <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>errJson<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>测试结果</p></blockquote> <p><img alt="image-20220111163442601" data-src="/assets/img/cb5073ebbb4eaf1d1b51c770bf191aa4.1b78be0f.png" loading="lazy" class="lazy"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/502051565/502051565.github.io/edit/master/docs/baodian/high/GLSC/14.glsc_sentinel.md" target="_blank" rel="noopener noreferrer">帮助我改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E" title="标签">#谷粒商城</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022年12月1日</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/high/GLSC/13.glsc_cart_service/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">商城高级-购物车消息订单</div></a> <a href="/high/GLSC/15.glsc_zipkin/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">商城高级-Zipkin链路追踪</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/high/GLSC/13.glsc_cart_service/" class="prev">商城高级-购物车消息订单</a></span> <span class="next"><a href="/high/GLSC/15.glsc_zipkin/">商城高级-Zipkin链路追踪</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/3lhq91/"><div>
            jvm
            <!----></div></a> <span class="date">06-01</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/3lhh91/"><div>
            多线程&amp;并发篇
            <!----></div></a> <span class="date">05-30</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/3lhl98/"><div>
            spring
            <!----></div></a> <span class="date">05-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:502051565@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="img/wx.jpg" title="微信" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><APlayer audio="" fixed="true" mini="true" theme="#b7daff" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div></div><div></div><div></div><div id="tcomment"></div><!----></div></div>
    <script src="/assets/js/app.52078691.js" defer></script><script src="/assets/js/2.3705e0fd.js" defer></script><script src="/assets/js/5.65db3320.js" defer></script><script src="/assets/js/41.f9580004.js" defer></script><script src="/assets/js/62.88bcb186.js" defer></script><script src="/assets/js/68.17898152.js" defer></script><script src="/assets/js/53.6e4f0023.js" defer></script><script src="/assets/js/54.7ab2b710.js" defer></script>
  </body>
</html>
