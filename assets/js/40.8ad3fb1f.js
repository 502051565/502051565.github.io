(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{1390:function(s,a,t){"use strict";t.r(a);var e=t(17),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"_1-docker-软件安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-软件安装"}},[s._v("#")]),s._v(" 1.Docker 软件安装")]),s._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#_1-1-tomcat安装使用"}},[s._v("1.1.Tomcat安装使用")]),e("ul",[e("li",[e("a",{attrs:{href:"#_1-版本选择"}},[s._v("1.版本选择")])]),e("li",[e("a",{attrs:{href:"#"}})]),e("li",[e("a",{attrs:{href:"#_2-安装修改"}},[s._v("2.安装修改")])]),e("li",[e("a",{attrs:{href:"#_3-启动使用"}},[s._v("3.启动使用")])]),e("li",[e("a",{attrs:{href:"#_4-挂载特性"}},[s._v("4.挂载特性")])]),e("li",[e("a",{attrs:{href:"#_5-相关指令"}},[s._v("5.相关指令")])])])]),e("li",[e("a",{attrs:{href:"#_1-2-mysql安装"}},[s._v("1.2.MySQL安装")]),e("ul",[e("li",[e("a",{attrs:{href:"#_1-安装启动"}},[s._v("1.安装启动")])]),e("li",[e("a",{attrs:{href:"#_2-其他命令"}},[s._v("2.其他命令")])])])]),e("li",[e("a",{attrs:{href:"#_1-3-redis安装"}},[s._v("1.3.Redis安装")]),e("ul",[e("li",[e("a",{attrs:{href:"#_1-安装"}},[s._v("1.安装")])]),e("li",[e("a",{attrs:{href:"#_2-启动"}},[s._v("2.启动")])]),e("li",[e("a",{attrs:{href:"#_3-其他"}},[s._v("3.其他")])])])]),e("li",[e("a",{attrs:{href:"#_1-4-elasticsearch安装"}},[s._v("1.4.ElasticSearch安装")]),e("ul",[e("li",[e("a",{attrs:{href:"#安装"}},[s._v("安装")])]),e("li",[e("a",{attrs:{href:"#配置"}},[s._v("配置")])]),e("li",[e("a",{attrs:{href:"#启动"}},[s._v("启动")])])])]),e("li",[e("a",{attrs:{href:"#_1-5-kibana安装"}},[s._v("1.5.Kibana安装")])])])]),e("p"),s._v(" "),e("img",{staticStyle:{zoom:"67%"},attrs:{src:t(950),alt:"image-20221118110513691"}}),s._v(" "),e("h2",{attrs:{id:"_1-1-tomcat安装使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-tomcat安装使用"}},[s._v("#")]),s._v(" 1.1.Tomcat安装使用")]),s._v(" "),e("h3",{attrs:{id:"_1-版本选择"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-版本选择"}},[s._v("#")]),s._v(" 1.版本选择")]),s._v(" "),e("p",[s._v("首先登录：https://hub.docker.com 账号：502051565@qq.com 密码：手机号 152..........")]),s._v(" "),e("p",[s._v("搜索框中搜索tomcat,选择点赞下载最多的")]),s._v(" "),e("img",{staticStyle:{zoom:"50%"},attrs:{src:t(951),alt:"image-20221118111354676"}}),s._v(" "),e("h3",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])]),s._v(" "),e("p",[s._v("tomcat 有很多的版本分支，一个版本可能有多个分支，如 "),e("code",[s._v("8-jre")]),s._v(" 代表 Tomcat 8 内置 jre8 的版本、 "),e("code",[s._v("8-jdk8")]),s._v(" 代表 Tomcat 8 内置 jdk8 的版本等等。所以根据需求进行版本选择。（jdk 包括了 jre，但是相对而言比较大）")]),s._v(" "),e("p",[e("img",{staticClass:"lazy",attrs:{alt:"image","data-src":t(952),loading:"lazy"}})]),s._v(" "),e("p",[e("code",[s._v("或者是通过命令框搜索意识一样的")])]),s._v(" "),e("p",[e("img",{staticClass:"lazy",attrs:{alt:"image-20221118111806703","data-src":t(953),loading:"lazy"}})]),s._v(" "),e("h3",{attrs:{id:"_2-安装修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装修改"}},[s._v("#")]),s._v(" 2.安装修改")]),s._v(" "),e("p",[s._v("这里选择的是 "),e("code",[s._v("8.5.82-jre8-temurin-focal")]),s._v(" 版本，先下载：")]),s._v(" "),e("p",[s._v("注意我们这里用的是阿里云镜像，是从阿里云镜像加速器拉取")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull tomcat:8.5.82-jre8-temurin-jammy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("下载的版本名太长，我们可以创建短的版本，然后删除掉长的版本")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nREPOSITORY                                            TAG                         IMAGE ID            CREATED             SIZE\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".91.166:5000/zzyyubuntu                        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v("                         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("658125043530")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago          112MB\nregistry.cn-shenzhen.aliyuncs.com/frx01/myubuntu1.3   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v("                         64df8ffb7faf        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          179MB\ntomcat                                                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(".82-jre8-temurin-jammy   0065fb7141cd        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         240MB\nregistry                                              latest                      b8604a3fe854        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" months ago       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nubuntu                                                latest                      ba6acccedd29        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" months ago       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(".8MB\ncentos                                                latest                      5d0da3dc9764        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" months ago       231MB\ntomcat                                                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(".27                      a92c139758db        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" years ago         558MB\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增短版本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker tag 0065fb7141cd tomcat:8.5.82")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除长版本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker rmi tomcat:8.5.82-jre8-temurin-jammy")]),s._v("\nUntagged: tomcat:8.5.82-jre8-temurin-jammy\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询查看镜像")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images tomcat")]),s._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ntomcat              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(".82              0065fb7141cd        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         240MB\ntomcat              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(".27              a92c139758db        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" years ago         558MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("h3",{attrs:{id:"_3-启动使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动使用"}},[s._v("#")]),s._v(" 3.启动使用")]),s._v(" "),e("p",[s._v("Tomcat 的使用相比较其他还是非常简单的，Tomcat 启动后，进入容器的默认目录是 "),e("code",[s._v("/usr/local/tomcat")]),s._v("，这里提供几个启动命令：")]),s._v(" "),e("ul",[e("li",[s._v("命名后台启动")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat01 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 tomcat:8.5.82\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("mark",[s._v("-p 小写，主机端口：docker容器端口；-P 大写，随机分配端口；i:交互；t:终端；d:后台")])]),s._v(" "),e("ul",[e("li",[s._v("webapps 启动：创建 webapps 的数据卷，在宿主机的挂载目录部署项目，就会同步到容器的 webapps 目录下")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat01 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -v tomcat01-webapps:/usr/local/tomcat/webapps tomcat:8.5.82\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("配置文件启动：创建配置文件的数据卷，在宿主机的挂载目录修改配置文件，就会同步到容器的配置文件中")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat01 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -v tomcat01-webapps:/usr/local/tomcat/webapps -v tomcat01-conf:/usr/local/tomcat/conf tomcat:8.5.82\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("code",[s._v("tomcat01-webapps")]),s._v(" 和 "),e("code",[s._v("tomcat01-conf")]),s._v(" 根据需求创建数据卷名。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat01 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -v tomcat01-webapps:/usr/local/tomcat/webapps tomcat:8.5.73\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器内部")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it tomcat01 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("进入 webapps 目录，查看内容：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("root@efc01854d5e1:/usr/local/tomcat"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd webapps")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内容为空")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("会发现为空，这是因为 Tomcat 官方把所有的初始化文件放到了 webapps.dist 目录下，我们去看看：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("root@efc01854d5e1:/usr/local/tomcat/webapps"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ../webapps.dist/")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\ndocs  examples  host-manager  manager  ROOT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("所以我们需要把 webapps.dist 的内容拷贝到 webapps 目录中，为什么不删除 webapps 目录然后把 webapps.dist 重命名呢？因为容器运行期间无法删除文件，而不运行我们无法进入容器内部，所以只能一个一个拷贝过去")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("root@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r docs/ ../webapps")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r examples/ ../webapps")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r host-manager/ ../webapps")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r manager/ ../webapps")]),s._v("\nroot@efc01854d5e1:/usr/local/tomcat/webapps.dist"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r ROOT/ ../webapps")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("此时我们进入默认目录 "),e("code",[s._v("/var/lib/docker/volumes/tomcat01-webapps/_data")]),s._v(" 下查看拷贝的内容是否同步过来：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入默认目录并查看内容")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes/tomcat01-webapps/_data\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\ndocs  examples  host-manager  manager  ROOT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("虽然同步过来了，但是这样子会很累对吧，而且重新启动一个新的 Tomcat 容器，必须要重新执行 5 个拷贝操作，我们可以利用数据卷来同步数据。")]),s._v(" "),e("h3",{attrs:{id:"_4-挂载特性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-挂载特性"}},[s._v("#")]),s._v(" 4.挂载特性")]),s._v(" "),e("p",[s._v("可以利用数据卷特性：")]),s._v(" "),e("ul",[e("li",[s._v("默认目录挂载：\n"),e("ul",[e("li",[s._v("当宿主机挂载目录已经存在时，双方挂载完成后，"),e("strong",[s._v("宿主机挂载目录覆盖容器挂载目录")])]),s._v(" "),e("li",[s._v("当宿主机挂载目录不存在时，双方挂载完成后，"),e("strong",[s._v("容器挂载目录覆盖宿主机挂载目录")])])])]),s._v(" "),e("li",[s._v("具体目录挂载\n"),e("ul",[e("li",[s._v("当宿主机挂载目录无论存不存在，双方挂载完成后，"),e("strong",[s._v("宿主机挂载目录都会覆盖容器挂载目录")])])])])]),s._v(" "),e("p",[s._v("所以我们有两种方式：")]),s._v(" "),e("p",[s._v("首先我们手动拷贝一份 tomcat01 的宿主机挂载目录，该目录已经将数据同步过来，目录有 webapps 的内容了")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝一份 tomcat01 的宿主机挂载目录，新的目录名叫 tomcat02-webapps")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r tomcat01-webapps tomcat02-webapps\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("方式 1：默认目录挂载")])])]),s._v(" "),e("p",[s._v("启动第二个 Tomcat 容器，利用 "),e("strong",[s._v("默认目录挂载")]),s._v(" 的第一个特性进行与容器的挂载")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat02 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(":8080 -v tomcat02-webapps:/usr/local/tomcat/webapps tomcat:8.5.73\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 tomcat02 容器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it tomcat02  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 webapps 目录，并查看内容")]),s._v("\nroot@50edd2a86a8d:/usr/local/tomcat"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd webapps")]),s._v("\nroot@50edd2a86a8d:/usr/local/tomcat/webapps"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\ndocs  examples  host-manager  manager  ROOT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("说明同步成功。")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("方式 2：具体目录挂载")])])]),s._v(" "),e("p",[s._v("启动第三个 Tomcat 容器，利用 "),e("strong",[s._v("具体目录挂载")]),s._v(" 方式进行与容器的挂载（缺点：指定到 _data 目录，因为该方式是从指定的目录覆盖容器的目录）")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name tomcat03 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),s._v(":8080 -v /var/lib/docker/volumes/tomcat02-webapps/_data:/usr/local/tomcat/webapps tomcat:8.5.73\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("进入容器看看，是否同步过来了")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 tomcat03 容器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it tomcat03 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 webapps 目录，并查看内容")]),s._v("\nroot@ba7961226856:/usr/local/tomcat"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd webapps")]),s._v("\nroot@ba7961226856:/usr/local/tomcat/webapps"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\ndocs  examples  host-manager  manager  ROOT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("说明同步成功。")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("总结：")])])]),s._v(" "),e("p",[e("mark",[s._v("推荐方式 1")]),s._v("，因为方式 2 必须指定到 _data 目录，不灵活。而使用方式 1，必须先确保宿主机存在该目录，并且目录里有想要的内容。")]),s._v(" "),e("p",[s._v("Tomcat 也有配置文件，里面可以修改 8080 端口，上面的第三个启动命令就是给配置文件进行数据卷挂载，步骤和 webapps 的两个例子一样，这里不演示了。")]),s._v(" "),e("p",[s._v("值得注意的是：修改完配置文件的端口后，需要重新 run 一个新的 Tomcat 容器，然后该容器和宿主机修改后的配置文件目录挂载，才能真正实现端口的修改，因为第一次端口映射在 run 时是 8080:8080，无法修改为 8080:XXXX(修改的端口)，需要重新 run 才行，而 run 出来的配置文件默认端口还是 8080，所以需要利用数据卷特性，让宿主机的配置文件覆盖容器的 8080 端口配置文件。")]),s._v(" "),e("h3",{attrs:{id:"_5-相关指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-相关指令"}},[s._v("#")]),s._v(" 5.相关指令")]),s._v(" "),e("p",[s._v("进入 Tomcat 容器")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名或 id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看 Tomcat 容器的日志")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加 -f 代表实时监听日志动态")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-f"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名或 id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_1-2-mysql安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-mysql安装"}},[s._v("#")]),s._v(" 1.2.MySQL安装")]),s._v(" "),e("p",[s._v("MySQL 版本网址："),e("a",{attrs:{href:"https://registry.hub.docker.com/_/mysql",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://registry.hub.docker.com/_/mysql"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"_1-安装启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装启动"}},[s._v("#")]),s._v(" 1.安装启动")]),s._v(" "),e("ul",[e("li",[s._v("拉取镜像到本地")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull mysql:5.7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_1-简单版"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-简单版"}},[s._v("#")]),s._v(" 1.简单版")]),s._v(" "),e("p",[s._v("运行 MySQL 服务")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name mysql -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" mysql:5.7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("密码自行修改。使用 3307 是因为宿主机可能已经安装了 MySQL，它占用了 3306 端口。")]),s._v(" "),e("h4",{attrs:{id:"_2-实战版"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-实战版"}},[s._v("#")]),s._v(" 2.实战版")]),s._v(" "),e("p",[s._v("拷贝挂载的目录，首次安装容器无需执行下面的操作，直接执行"),e("mark",[s._v("无注解版(可用)")]),s._v("中的命令：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先创建挂载目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /docker/mysql\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MySQL的相关文件同步到挂载目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" mysql:/var/lib/mysql /docker/mysql/data\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" mysql:/etc/mysql/conf.d /docker/mysql/conf\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" mysql:/var/log /docker/mysql/log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("为什么要拷贝出来呢？因为一旦挂载成功，宿主机的挂载目录会覆盖容器的目录，所以我们确保宿主机的挂载目录不能为空，必须要有原来容器目录的文件。")]),s._v(" "),e("ul",[e("li",[s._v("宿主机与容器实现挂载，保证数据安全，对应上方拷贝出来的目录")])]),s._v(" "),e("tabs",{attrs:{"cache-lifetime":"5",options:{useUrlFragment:!1}}},[e("tab",{attrs:{name:"**无注解版(可用)**"}},[e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name mysql "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --restart always "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /docker/mysql/data:/var/lib/mysql "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /docker/mysql/conf:/etc/mysql/conf.d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /docker/mysql/log:/var/log "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    mysql:5.7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])])]),s._v(" "),e("tab",{attrs:{name:"有注解版(只看不用)"}},[e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name mysql "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t\t\t\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名为 mysql")]),s._v("\n    --restart always "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t\t\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Docker 重启，容器也重启")]),s._v("\n    -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t\t\t\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器内部 3306 端口映射到 主机的 3306 端口")]),s._v("\n    -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置登陆密码为 123456，登陆用户为 root")]),s._v("\n    -v /docker/mysql/data:/var/lib/mysql "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器的「数据」挂载到主机的相应文件夹")]),s._v("\n    -v /docker/mysql/conf:/etc/mysql/conf.d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器的「自定义配置文件夹」挂载到主机的相应文件夹")]),s._v("\n    -v /docker/mysql/log:/var/log "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器的「日志文件夹」挂载到主机的相应位置")]),s._v("\n    mysql:5.7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])])])],1),s._v(" "),e("p",[s._v("宿主机的挂载目录、conf.d 目录、data 数据目录、日志目录根据需求决定，包括密码。")]),s._v(" "),e("p",[s._v("这里说明一下：主配置文件名叫 my.cnf，位置在 "),e("code",[s._v("/etc/mysql")]),s._v("，但是不建议直接操作 my.cnf 主配置文件，官方也是如此，所以官方提供了 conf.d 目录，只要在 conf.d 目录下创建 xx.cnf 配置文件，那么该配置文件自动被引入 my.cnf 主配置文件，避免直接操作 my.cnf 引起安全问题。")]),s._v(" "),e("p",[s._v("my.cnf 文件里有这么一句代码：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("includedir /etc/mysql/conf.d/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("可以看出，my.cnf 会自动读取该目录下的所有 .cnf 配置文件。")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),e("p",[s._v("确保简单启动的密码和挂载启动的保持一致，因为启动后，密码保存在 "),e("code",[s._v("/var/lib/mysql")]),s._v(" 目录下，而挂载的时候，宿主机的该目录会覆盖容器的目录，导致密码是简单启动的密码。所以确保两种启动方式密码保持一致。")])]),s._v(" "),e("ul",[e("li",[s._v("配置 UTF-8 编码")])]),s._v(" "),e("p",[s._v("进入宿主机的配置文件挂载目录："),e("code",[s._v("/docker/mysql/conf")]),s._v("，有一个 mysql.cnf 配置文件，编辑它")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /docker/mysql/conf\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" mysql.cnf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("添加如下内容（如果文件有 "),e("code",[s._v("[mysql]")]),s._v("，必须先删除掉）：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncharacter-set-server"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\ncollation-server"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8_general_ci\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault-character-set"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("进入 MySQL 容器，配置 UTF-8 编码")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 容器名 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器id "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("进入容器后，登录 MySQL")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[s._v("mysql "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看数据库的编码是否是 UTF-8")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%char%'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如图则代表配置成功：")]),s._v(" "),e("p",[e("img",{staticClass:"lazy",attrs:{alt:"image","data-src":t(954),loading:"lazy"}})]),s._v(" "),e("ul",[e("li",[s._v("外部查看 MySQL 日志（可选）")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs 容器id "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-其他命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-其他命令"}},[s._v("#")]),s._v(" 2.其他命令")]),s._v(" "),e("ul",[e("li",[s._v("将 MySQL 数据库备份为 sql 文件\n"),e("ul",[e("li",[s._v("导出全部数据库的数据为 sql 文件")])])])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 容器名 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exec mysqldump --all-databases -uroot -p\"$MYSQL_ROOT_PASSWORD\"'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/all-database.sql \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("用户名要根据需求替换、"),e("code",[s._v("/opt/all-database")]),s._v(" 是导出文件的路径，需要根据需求修改。密码不需要修改，它会自动获取登录的密码。")]),s._v(" "),e("li",[s._v("导出指定的数据库数据的 sql 文件")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 容器名 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exec mysqldump --databases 库名 -uroot -p\"$MYSQL_ROOT_PASSWORD\"'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/one-database.sql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("导出指定的数据库，但是不要数据")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 容器名 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exec mysqldump --no-data --databases 库名 -uroot -p\"$MYSQL_ROOT_PASSWORD\"'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/one-database.sql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("执行 sql 文件到 MySQL 中")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 容器名 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 容器id "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exec mysql -uroot -p\"$MYSQL_ROOT_PASSWORD\"'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /opt/xxx.sql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("code",[s._v("/opt/xxx.sql")]),s._v(" 是 sql 文件的路径。")]),s._v(" "),e("h2",{attrs:{id:"_1-3-redis安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-redis安装"}},[s._v("#")]),s._v(" 1.3.Redis安装")]),s._v(" "),e("h3",{attrs:{id:"_1-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[s._v("#")]),s._v(" 1.安装")]),s._v(" "),e("p",[s._v("Redis 版本网址："),e("a",{attrs:{href:"https://registry.hub.docker.com/_/redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://registry.hub.docker.com/_/redis"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("Redis 的安装还是比较简单的，这里安装 6.62 版本")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull redis:6.2.6\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 docker 容器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动"}},[s._v("#")]),s._v(" 2.启动")]),s._v(" "),e("p",[s._v("Redis 启动后，进入容器的默认目录是 "),e("code",[s._v("/data")])]),s._v(" "),e("p",[s._v("启动指令：")]),s._v(" "),e("ul",[e("li",[s._v("简单的启动，也是最快速的个人使用启动：")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 redis:6.2.6\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("AOP 持久化启动")]),s._v(" "),e("p",[s._v("指定持久化的 .aop 文件路径，宿主机的文件路径根据需求存放，容器的文件路径默认在 "),e("code",[s._v("/data")])])])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -v redis_data:/data redis:6.2.6 redis-server --appendonly "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("容器的 "),e("code",[s._v("/data")]),s._v(" 是 AOP 文件的默认路径，"),e("code",[s._v("redis_data")]),s._v(" 根据需求修改，是宿主机的挂载目录，而 "),e("code",[s._v("redis-server --appendonly yes")]),s._v(" 是必须的，这个命令会覆盖默认的命令，默认的命令是关闭持久化。")]),s._v(" "),e("ul",[e("li",[s._v("自定义配置文件启动：指定配置文件的路径和容器的 "),e("code",[s._v("/usr/local/etc/redis")]),s._v(" 挂载，一旦挂载后，容器的该目录获得配置文件，然后通过 "),e("code",[s._v("redis-server /usr/local/etc/redis/redis.conf")]),s._v(" 启动该配置文件")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#首先在宿主机上创建一个目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /app/redis\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在/opt/下创建一个redis.conf文件 如何准备一份 redis.conf 文件呢？看下面")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行启动命令")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name redis -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -v /opt/redis.conf:/usr/local/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.2.6 redis-server /usr/local/etc/redis/redis.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动成功后进入redis验证")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 7157361dc69e /bin/bash\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入 cd /usr/local/etc/redis/ 可以看到redis配置文件已经存在")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接redis，进行操作")]),s._v("\nroot@7157361dc69e:/data"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOAUTH Authentication required. "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个错误是因为没有使用密码连接，也可以证明配置文件使用的是我们在宿主机的配置文件 /opt/redis.conf")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" auth "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\nOK\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\nOK\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k1\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("p",[e("code",[s._v("/opt/redis.conf")]),s._v(" 是在宿主机的配置文件路径，根据需求修改。")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意：Redis 容器内没有 redis.conf 文件，启动的配置信息都是默认的。我们需要自己准备好一份 redis.conf 文件，然后通过数据卷传进容器内")])])]),s._v(" "),e("p",[e("mark",[s._v("如何准备一份 redis.conf 文件呢？")])]),s._v(" "),e("ul",[e("li",[e("p",[s._v("去官网下载对应的 Windows 版本，然后拷贝 redis.conf 到 Linux 下，再启动配置，这样很麻烦对吧")])]),s._v(" "),e("li",[e("p",[s._v("直接 Linux 下创建一个 redis.conf 文件，虽然不如原生的全面，但是我们只需要加入自己的一些配置即可，其他配置 Redis 自动使用默认的")]),s._v(" "),e("p",[s._v("比如：")])])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据需求指定创建路径")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" redis.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 redis.conf 加入如下内容")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制能访问 redis 的地址，根据需求修改")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认是 yes，开启保护模式")]),s._v("\nprotected-mode no\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 redis 连接密码，可选")]),s._v("\nrequirepass "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以守护进程方式启动，可后台启动")]),s._v("\ndaemonize no\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改本地 redis 数据库存放文件夹（可选）")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" ./\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AOP 持久化")]),s._v("\nappendonly "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("ul",[e("li",[s._v("redis.conf常用配置")])]),s._v(" "),e("blockquote",[e("ul",[e("li",[e("p",[s._v("bind 0.0.0")]),s._v(" "),e("p",[s._v("限制 redis 只能本地访问，根据需求修改")])]),s._v(" "),e("li",[e("p",[s._v("protected-mode no")]),s._v(" "),e("p",[s._v("默认是 yes，开启保护模式，限制为本地访问")])]),s._v(" "),e("li",[e("p",[s._v("requirepass 123456")]),s._v(" "),e("p",[s._v("配置redis连接密码，默认是注释的")])]),s._v(" "),e("li",[e("p",[s._v("daemonize no")]),s._v(" "),e("p",[s._v("默认 no，改为 yes 代表以守护进程方式启动，可后台运行，除非kill进程（可选），改为 yes 会使配置文件方式启动 redis 失败")])]),s._v(" "),e("li",[e("p",[s._v("dir ./")]),s._v(" "),e("p",[s._v("更改本地 redis 数据库存放文件夹（可选）")])]),s._v(" "),e("li",[e("p",[s._v("appendonly yes")]),s._v(" "),e("p",[s._v("redis 持久化（开启了这个，redis 就不会每次重启时自动清空了）")])])])]),s._v(" "),e("p",[s._v("如果不加入 "),e("code",[s._v("appendonly yes")]),s._v("，可以利用 AOP 持久化启动来指定 "),e("code",[s._v("appendonly yes")]),s._v(" 启动。")]),s._v(" "),e("h3",{attrs:{id:"_3-其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-其他"}},[s._v("#")]),s._v(" 3.其他")]),s._v(" "),e("p",[s._v("启动后进入 redis 容器")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看 redis 的日志")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加 -f 代表实时监听日志动态")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-f"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("输入 "),e("code",[s._v("redis-cli")]),s._v(" 连接 redis，如果是连接其他服务器的 redis，则需要加参数")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("redis-cli -h IP地址 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_1-4-elasticsearch安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-elasticsearch安装"}},[s._v("#")]),s._v(" 1.4.ElasticSearch安装")]),s._v(" "),e("h3",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("p",[s._v("ElasticSearch 版本网址："),e("a",{attrs:{href:"https://registry.hub.docker.com/_/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://registry.hub.docker.com/_/elasticsearch"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("这里下载的版本是 7.14.2")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull elasticsearch:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),e("p",[s._v("如果启动报错")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("max virtual memory areas vm.max_map_count "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("65530")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" is too low，increase to at least "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("则需要进行配置，没有出现错误可以跳过")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置 sysctl.conf")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/stsctl.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入配置信息")]),s._v("\nvm.max_map_count"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用配置")]),s._v("\nsysctl -p\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),e("p",[s._v("三种启动方式：")]),s._v(" "),e("ul",[e("li",[s._v("简单启动")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name elasticsearch -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 elasticsearch:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果报错，请看 "),e("a",{attrs:{href:"/project-management/Docker/Docker_Software_installation#%E9%85%8D%E7%BD%AE"}},[s._v("配置")]),s._v(" 进行解决")]),s._v(" "),e("p",[s._v("浏览器访问的是 9200 端口")]),s._v(" "),e("ul",[e("li",[s._v("持久化和配置文件启动")])]),s._v(" "),e("p",[s._v("ES 中所有的数据都在容器中的 "),e("code",[s._v("/usr/share/elasticsearch/data")]),s._v(" 目录，配置文件在 "),e("code",[s._v("/usr/share/elasticsearch/config")]),s._v("，所以需要挂载出来")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name elasticsearch -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -v es_data:/usr/share/elasticsearch/data -v es_config:/usr/share/elasticsearch/config elasticsearch:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("挂载成功后，哪怕容器被删除了，数据还是会存在宿主机的 "),e("code",[s._v("/.../es_data")]),s._v(" 目录下")]),s._v(" "),e("ul",[e("li",[s._v("ik 分词器启动")])]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("方式 1：")])])]),s._v(" "),e("p",[s._v("首先下载好 ik 分词器，版本要和 ES 版本一致，放到 Linux 系统中，我们知道，ES 的插件目录是 "),e("code",[s._v("/usr/share/elasticsearch/plugins")]),s._v(" 下，所以需要挂载出来")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name elasticsearch -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -v es_data:/usr/share/elasticsearch/data -v es_config:/usr/share/elasticsearch/config -v es_plugins:/usr/share/elasticsearch/plugins elasticsearch:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("此时的 "),e("code",[s._v("es_plugins")]),s._v(" 目录下为空，我们把下载好的 ik 分词器放到该目录下，然后重启 ES 即可")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ik 分词器"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/lib/docker/volumes/es_plugins/_data\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 es")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart elasticsearch\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[e("strong",[s._v("方式 2：")])])]),s._v(" "),e("p",[s._v("先创建数据卷，把 ik 分词器放到数据卷里")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create es_plugins\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ik 分词器"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/lib/docker/volumes/es_plugins/_data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("再启动容器进行挂载")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name elasticsearch -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 -v es_data:/usr/share/elasticsearch/data -v es_config:/usr/share/elasticsearch/config -v es_plugins:/usr/share/elasticsearch/plugins elasticsearch:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_1-5-kibana安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-kibana安装"}},[s._v("#")]),s._v(" 1.5.Kibana安装")]),s._v(" "),e("p",[s._v("Kibana 版本网址："),e("a",{attrs:{href:"https://registry.hub.docker.com/_/kibana",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://registry.hub.docker.com/_/kibana"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("下载 Kibaba 镜像，版本要和 ElasticSearch 一致。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull kibana:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("简单启动")]),s._v(" "),e("p",[s._v("此时没有指定连接 ES")])])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name kibana -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 kibaba:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("连接 ES 启动")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name kibana -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ELASTICSEARCH_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://IP地址:9200 kibaba:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("先简单启动，后在配置文件再连接 ES，重启生效")])]),s._v(" "),e("p",[s._v("首先知道配置文件的路径是 "),e("code",[s._v("/usr/share/kibana/config")]),s._v("，将它挂载出来")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name kibana -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 -v kibana_conf:/usr/share/kibana/config kibana:7.14.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动后进入宿主机的 kibana_conf 目录或者 容器的 "),e("code",[s._v("/usr/share/kibana/config")]),s._v(" 目录，这里演示前者")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes/kibana_conf/_data\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kibana.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("修改为 ES 的 IP 地址")]),s._v(" "),e("p",[e("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting1@master/20220919/image.4uzub0kmmoi0.png",loading:"lazy"}})])],1)}),[],!1,null,null,null);a.default=n.exports},950:function(s,a,t){s.exports=t.p+"assets/img/image-20221118110513691.5d96ca3c.png"},951:function(s,a,t){s.exports=t.p+"assets/img/image-20221118111354676.23bcaa23.png"},952:function(s,a,t){s.exports=t.p+"assets/img/image.2ylgcekrxva0.fc3bd835.png"},953:function(s,a,t){s.exports=t.p+"assets/img/image-20221118111806703.5605b5eb.png"},954:function(s,a,t){s.exports=t.p+"assets/img/image.2fc62z4b02vw.939bed5e.png"}}]);