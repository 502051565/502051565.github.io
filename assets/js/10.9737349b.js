(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1043:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151119562.7166d4ba.png"},1044:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151230904.85541819.png"},1045:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151306019.4ff1a30b.png"},1046:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151335161.aedffda2.png"},1047:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151354666.77cf7ce4.png"},1048:function(a,s,t){a.exports=t.p+"assets/img/image-20221123151422394.63c2e716.png"},1049:function(a,s,t){a.exports=t.p+"assets/img/image-20221123152712642.5ee8f16a.png"},1050:function(a,s,t){a.exports=t.p+"assets/img/image-20221123152727613.7e2aaebb.png"},1051:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154200998.200199f8.png"},1052:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154222332.7e358332.png"},1053:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154236936.8a9a549e.png"},1054:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154257644.612737d7.png"},1055:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154315068.e101d12b.png"},1056:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154331453.ce6a55c2.png"},1057:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154355280.e95cbbaa.png"},1058:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154407157.f1a2d44b.png"},1059:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154420411.977ec2c1.png"},1060:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154433978.8399d5b7.png"},1061:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154444674.70762077.png"},1062:function(a,s,t){a.exports=t.p+"assets/img/image-20221123154453725.f4feae2c.png"},1397:function(a,s,t){"use strict";t.r(s);var n=t(17),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"_1-docker容器监控之-cadvisor-influxdb-granfana"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker容器监控之-cadvisor-influxdb-granfana"}},[a._v("#")]),a._v(" 1.Docker容器监控之 CAdvisor+InfluxDB+Granfana")]),a._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#_1-原生命令"}},[a._v("1.原生命令")])]),n("li",[n("a",{attrs:{href:"#_2-是什么"}},[a._v("2.是什么")])]),n("li",[n("a",{attrs:{href:"#_3-compose容器编排"}},[a._v("3.compose容器编排")])]),n("li",[n("a",{attrs:{href:"#_4-测试"}},[a._v("4.测试")])])])]),n("p"),a._v(" "),n("h2",{attrs:{id:"_1-原生命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-原生命令"}},[a._v("#")]),a._v(" 1.原生命令")]),a._v(" "),n("p",[a._v("操作")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stats\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151119562","data-src":t(1043),loading:"lazy"}})]),a._v(" "),n("p",[a._v("问题")]),a._v(" "),n("p",[a._v("通过docker stats命令可以很方便的看到当前宿主机上所有容器的CPU,内存以及网络流量等数据，一般小公司够用了。但是，docker stats统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能。")]),a._v(" "),n("h2",{attrs:{id:"_2-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-是什么"}},[a._v("#")]),a._v(" 2.是什么")]),a._v(" "),n("p",[a._v("容器监控3剑客")]),a._v(" "),n("p",[a._v("一句话")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151230904","data-src":t(1044),loading:"lazy"}})]),a._v(" "),n("p",[a._v("CAdvisor监控收集+InfluxDB存储数据+Granfana展示图表")]),a._v(" "),n("p",[a._v("CAdvisor")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151306019","data-src":t(1045),loading:"lazy"}})]),a._v(" "),n("p",[a._v("InfluxDB")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151335161","data-src":t(1046),loading:"lazy"}})]),a._v(" "),n("p",[a._v("Granfana")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151354666","data-src":t(1047),loading:"lazy"}})]),a._v(" "),n("p",[a._v("总结")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123151422394","data-src":t(1048),loading:"lazy"}})]),a._v(" "),n("h2",{attrs:{id:"_3-compose容器编排"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-compose容器编排"}},[a._v("#")]),a._v(" 3.compose容器编排")]),a._v(" "),n("p",[a._v("新建目录")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@noed2 myfile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mkdir cig")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@noed2 myfile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cd cig")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@noed2 cig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# pwd")]),a._v("\n/myfile/cig\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[a._v("新建3件套组合的 docker-compose.yml")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[a._v("docker-compose.yml\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[a._v("version: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3.1'")]),a._v("\n\nvolumes:\n  grafana_data: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\nservices:\n  influxdb:\n    image: tutum/influxdb:0.9\n    restart: always\n    environment:\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PRE_CREATE_DB")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cadvisor\n    ports:\n      - "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8083:8083"')]),a._v("\n      - "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8086:8086"')]),a._v("\n    volumes:\n      - ./data/influxdb:/data\n\n  cadvisor:\n    image: google/cadvisor\n    links:\n      - influxdb:influxsrv\n    command: -storage_driver"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("influxdb -storage_driver_db"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cadvisor -storage_driver_host"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("influxsrv:8086\n    restart: always\n    ports:\n      - "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8080:8080"')]),a._v("\n    volumes:\n      - /:/rootfs:ro\n      - /var/run:/var/run:rw\n      - /sys:/sys:ro\n      - /var/lib/docker/:/var/lib/docker:ro\n\n  grafana:\n    user: "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"104"')]),a._v("\n    image: grafana/grafana\n    restart: always\n    links:\n      - influxdb:influxsrv\n    ports:\n     - "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3000:3000"')]),a._v("\n    volumes:\n     - grafana_data:/var/lib/grafana\n    environment:\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("HTTP_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("HTTP_PASS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INFLUXDB_HOST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("influxsrv\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INFLUXDB_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("8086")]),a._v("\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INFLUXDB_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cadvisor\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INFLUXDB_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root\n      - "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INFLUXDB_PASS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br"),n("span",{staticClass:"line-number"},[a._v("26")]),n("br"),n("span",{staticClass:"line-number"},[a._v("27")]),n("br"),n("span",{staticClass:"line-number"},[a._v("28")]),n("br"),n("span",{staticClass:"line-number"},[a._v("29")]),n("br"),n("span",{staticClass:"line-number"},[a._v("30")]),n("br"),n("span",{staticClass:"line-number"},[a._v("31")]),n("br"),n("span",{staticClass:"line-number"},[a._v("32")]),n("br"),n("span",{staticClass:"line-number"},[a._v("33")]),n("br"),n("span",{staticClass:"line-number"},[a._v("34")]),n("br"),n("span",{staticClass:"line-number"},[a._v("35")]),n("br"),n("span",{staticClass:"line-number"},[a._v("36")]),n("br"),n("span",{staticClass:"line-number"},[a._v("37")]),n("br"),n("span",{staticClass:"line-number"},[a._v("38")]),n("br"),n("span",{staticClass:"line-number"},[a._v("39")]),n("br"),n("span",{staticClass:"line-number"},[a._v("40")]),n("br"),n("span",{staticClass:"line-number"},[a._v("41")]),n("br"),n("span",{staticClass:"line-number"},[a._v("42")]),n("br"),n("span",{staticClass:"line-number"},[a._v("43")]),n("br"),n("span",{staticClass:"line-number"},[a._v("44")]),n("br"),n("span",{staticClass:"line-number"},[a._v("45")]),n("br"),n("span",{staticClass:"line-number"},[a._v("46")]),n("br"),n("span",{staticClass:"line-number"},[a._v("47")]),n("br"),n("span",{staticClass:"line-number"},[a._v("48")]),n("br"),n("span",{staticClass:"line-number"},[a._v("49")]),n("br")])]),n("p",[a._v("验证")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" config -q\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[a._v("启动docker-compose文件")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123152712642","data-src":t(1049),loading:"lazy"}})]),a._v(" "),n("p",[a._v("查看三个服务容器是否启动")]),a._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123152727613","data-src":t(1050),loading:"lazy"}})]),a._v(" "),n("h2",{attrs:{id:"_4-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试"}},[a._v("#")]),a._v(" 4.测试")]),a._v(" "),n("p",[a._v("浏览cAdvisor收集服务，http://ip:8080/")]),a._v(" "),n("p",[a._v("访问：http://192.168.233.130:8080")]),a._v(" "),n("p",[a._v("第一次访问慢，cadvisor也有基础的图形展现功能，这里主要用它来作数据采集")]),a._v(" "),n("p",[a._v("浏览influxdb存储服务，http://ip:8083/")]),a._v(" "),n("p",[a._v("访问：http://192.168.233.130:8083")]),a._v(" "),n("p",[a._v("浏览grafana展现服务，http://ip:3000")]),a._v(" "),n("p",[a._v("访问：http://192.168.233.130:3000")]),a._v(" "),n("p",[a._v("ip+3000端口的方式访问,默认帐户密码（admin/admin）")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154200998","data-src":t(1051),loading:"lazy"}})]),a._v(" "),n("p",[a._v("配置步骤")]),a._v(" "),n("p",[a._v("配置数据源")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154222332","data-src":t(1052),loading:"lazy"}})]),a._v(" "),n("p",[a._v("选择influxdb数据源")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154236936","data-src":t(1053),loading:"lazy"}})]),a._v(" "),n("p",[a._v("配置细节")]),a._v(" "),n("ol",[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154257644","data-src":t(1054),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"2"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154315068","data-src":t(1055),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"3"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154331453","data-src":t(1056),loading:"lazy"}})]),a._v(" "),n("p",[a._v("配置面板panel")]),a._v(" "),n("ol",[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154355280","data-src":t(1057),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"2"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154407157","data-src":t(1058),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"3"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154420411","data-src":t(1059),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"4"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154433978","data-src":t(1060),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"5"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154444674","data-src":t(1061),loading:"lazy"}})]),a._v(" "),n("ol",{attrs:{start:"6"}},[n("li")]),a._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"image-20221123154453725","data-src":t(1062),loading:"lazy"}})]),a._v(" "),n("p",[a._v("到这里cAdvisor+InfluxDB+Grafana容器监控系统就部署完成了")]),a._v(" "),n("p",[a._v("end;")])])}),[],!1,null,null,null);s.default=e.exports}}]);